
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dask Dataframes &#8212; Python tools for Big data</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://pnavaro.github.io/big-data/16-DaskDataframes.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Spark DataFrames" href="17-SparkDataFrames.html" />
    <link rel="prev" title="PySpark" href="15-PySpark.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logoR2-Noir.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Python tools for Big data</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-GitBasics.html">
   Git basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-Installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-JupyterQuickStart.html">
   Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-WordCount.html">
   Wordcount
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-MapReduce.html">
   Map Reduce
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-ParallelComputation.html">
   Parallel Computation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-AsynchronousProcessing.html">
   Asynchronous Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-DaskDelayed.html">
   Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09-DaskBag.html">
   Dask bag
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10-PandasSeries.html">
   Pandas Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-PandaDataframes.html">
   Pandas Dataframes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-UnixCommands.html">
   Basic Commands in the Unix Shell
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-Hadoop.html">
   Hadoop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14-FileFormats.html">
   File Formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-PySpark.html">
   PySpark
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Dask Dataframes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17-SparkDataFrames.html">
   Spark DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18-NYCTaxiCabTripDask.html">
   Dask dataframes on HDFS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19-NYCTaxiCabTripSpark.html">
   Spark dataframes on HDFS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20-NYCFlightsSpark.html">
   NYC Flights data analysis with Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21-NYCFLights2013Spark.html">
   NYC Flights data 2013 with Weather data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="22-SparkExercises.html">
   Start the spark session
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/pnavaro/big-data/master?urlpath=tree/notebooks/16-DaskDataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/pnavaro/big-data/blob/master/notebooks/16-DaskDataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/pnavaro/big-data"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/pnavaro/big-data/issues/new?title=Issue%20on%20page%20%2F16-DaskDataframes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/pnavaro/big-data/edit/master/notebooks/16-DaskDataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/16-DaskDataframes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframes">
   DataFrames
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prep-the-data">
     Prep the Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-data-from-csvs-in-dask-dataframes">
     Load Data from CSVs in Dask Dataframes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-just-happened">
     What just happened?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-df-is-ten-times-longer">
     Why df is ten times longer ?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computations-with-dask-dataframe">
   Computations with
   <code class="docutils literal notranslate">
    <span class="pre">
     dask.dataframe
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#store-data-in-apache-parquet-format">
   Store Data in Apache Parquet Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parquet-advantages">
     Parquet advantages:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-15-1">
     Exercise 15.1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#divisions-and-the-index">
   Divisions and the Index
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercises-15-2">
     Exercises 15.2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sharing-intermediate-results">
   Sharing Intermediate Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-two-calls-to-compute">
     Using two calls to
     <code class="docutils literal notranslate">
      <span class="pre">
       .compute
      </span>
     </code>
     :
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-one-call-to-dask-compute">
     Using one call to
     <code class="docutils literal notranslate">
      <span class="pre">
       dask.compute
      </span>
     </code>
     :
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Dask Dataframes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframes">
   DataFrames
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prep-the-data">
     Prep the Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-data-from-csvs-in-dask-dataframes">
     Load Data from CSVs in Dask Dataframes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-just-happened">
     What just happened?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-df-is-ten-times-longer">
     Why df is ten times longer ?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computations-with-dask-dataframe">
   Computations with
   <code class="docutils literal notranslate">
    <span class="pre">
     dask.dataframe
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#store-data-in-apache-parquet-format">
   Store Data in Apache Parquet Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parquet-advantages">
     Parquet advantages:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-15-1">
     Exercise 15.1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#divisions-and-the-index">
   Divisions and the Index
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercises-15-2">
     Exercises 15.2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sharing-intermediate-results">
   Sharing Intermediate Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-two-calls-to-compute">
     Using two calls to
     <code class="docutils literal notranslate">
      <span class="pre">
       .compute
      </span>
     </code>
     :
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-one-call-to-dask-compute">
     Using one call to
     <code class="docutils literal notranslate">
      <span class="pre">
       dask.compute
      </span>
     </code>
     :
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="dask-dataframes">
<h1>Dask Dataframes<a class="headerlink" href="#dask-dataframes" title="Permalink to this headline">#</a></h1>
<p><em><a class="reference external" href="http://dask.pydata.org">Dask</a> is a flexible parallel computing library for analytic computing</em> written in Python. Dask is similar to Spark, by lazily constructing directed acyclic graph (DAG) of tasks and splitting large datasets into small portions called partitions. See the below image from <a class="reference external" href="http://dask.pydata.org">Dask’s web page</a> for illustration.</p>
<p><img alt="http://dask.pydata.org/en/latest/_images/collections-schedulers.png" src="_images/collections-schedulers.png" /></p>
<p>It has three main interfaces:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://dask.pydata.org/en/latest/array.html">Array</a>, which works like <a class="reference external" href="http://www.numpy.org/">NumPy</a> arrays;</p></li>
<li><p><a class="reference external" href="http://dask.pydata.org/en/latest/bag.html">Bag</a>, which is similar to RDD interface in Spark;</p></li>
<li><p><a class="reference external" href="http://dask.pydata.org/en/latest/dataframe.html">DataFrame</a>, which works like <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> DataFrame.</p></li>
</ul>
<p>While it can work on a <a class="reference external" href="http://dask.pydata.org/en/latest/distributed.html">distributed cluster</a>, Dask works also very well on a single cpu machine.</p>
<section id="dataframes">
<h2>DataFrames<a class="headerlink" href="#dataframes" title="Permalink to this headline">#</a></h2>
<p>Dask dataframes look and feel (mostly) like Pandas dataframes but they run on the same infrastructure that powers dask.delayed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code> module implements a blocked parallel <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object that mimics a large subset of the Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. One dask <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is comprised of many in-memory pandas <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> separated along the index. One operation on a dask <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> triggers many pandas operations on the constituent pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s in a way that is mindful of potential parallelism and memory constraints.</p>
<p><strong>Related Documentation</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="http://dask.pydata.org/en/latest/dataframe.html">Dask DataFrame documentation</a></p></li>
<li><p><a class="reference external" href="http://pandas.pydata.org/">Pandas documentation</a></p></li>
</ul>
<p>In this notebook, we will extracts some historical flight data for flights out of NYC between 1990 and 2000. The data is taken from <a class="reference external" href="http://stat-computing.org/dataexpo/2009/the-data.html">here</a>. This should only take a few seconds to run.</p>
<p>We will use <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code> construct our computations for us.  The <code class="docutils literal notranslate"><span class="pre">dask.dataframe.read_csv</span></code> function can take a globstring like <code class="docutils literal notranslate"><span class="pre">&quot;data/nycflights/*.csv&quot;</span></code> and build parallel computations on all of our data at once.</p>
<p><strong>Variable descriptions</strong></p>
<p>Name	Description</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Year</span></code> 1987-2008</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Month</span></code> 1-12</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DayofMonth</span></code> 1-31</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DayOfWee</span></code> 1 (Monday) - 7 (Sunday)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DepTime</span></code> actual departure time (local, hhmm)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CRSDepTime</span></code> scheduled departure time (local, hhmm)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrTime</span></code> actual arrival time (local, hhmm)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CRSArrTime</span></code> scheduled arrival time (local, hhmm)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UniqueCarrier</span></code> unique carrier code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FlightNum</span></code> flight number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TailNu</span></code> plane tail number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ActualElapsedTime</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CRSElapsedTime</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AirTime</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ArrDelay</span></code> arrival delay, in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DepDelay</span></code> departure delay, in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Origin</span></code> origin IATA airport code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dest</span></code> destination IATA airport code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Distance</span></code> in miles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TaxiIn</span></code> taxi in time, in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TaxiOut</span></code> taxi out time in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Cancelled</span></code> was the flight cancelled?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CancellationCode</span></code> reason for cancellation (A = carrier, B = weather, C = NAS, D = security)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Diverted</span></code> 1 = yes, 0 = no</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CarrierDelay</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WeatherDelay</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NASDelay</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SecurityDelay</span></code> in minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LateAircraftDelay</span></code> in minutes</p></li>
</ol>
<section id="prep-the-data">
<h3>Prep the Data<a class="headerlink" href="#prep-the-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;max.rows&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>  <span class="c1"># library to get directory and file paths</span>
<span class="kn">import</span> <span class="nn">tarfile</span> <span class="c1"># this module makes possible to read and write tar archives</span>

<span class="k">def</span> <span class="nf">extract_flight</span><span class="p">():</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">flightdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;nycflights&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">flightdir</span><span class="p">):</span>
       <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting flight data&quot;</span><span class="p">)</span>
       <span class="n">tar_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;nycflights.tar.gz&#39;</span><span class="p">)</span>
       <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">flights</span><span class="p">:</span>
          <span class="n">flights</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;data/&#39;</span><span class="p">)</span>
            
<span class="n">extract_flight</span><span class="p">()</span> <span class="c1"># this function call will extract 10 csv files in data/nycflights</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-data-from-csvs-in-dask-dataframes">
<h3>Load Data from CSVs in Dask Dataframes<a class="headerlink" href="#load-data-from-csvs-in-dask-dataframes" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;nycflights&#39;</span><span class="p">,</span> <span class="s1">&#39;*.csv&#39;</span><span class="p">)</span>
<span class="n">filenames</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span>
                 <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look to the dataframe</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Get the first 5 rows</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">traceback</span> <span class="c1"># we use traceback because we expect an error.</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># Get the last 5 rows</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-just-happened">
<h3>What just happened?<a class="headerlink" href="#what-just-happened" title="Permalink to this headline">#</a></h3>
<p>Unlike <code class="docutils literal notranslate"><span class="pre">pandas.read_csv</span></code> which reads in the entire file before inferring datatypes, <code class="docutils literal notranslate"><span class="pre">dask.dataframe.read_csv</span></code> only reads in a sample from the beginning of the file (or first file if using a glob). These inferred datatypes are then enforced when reading all partitions.</p>
<p>In this case, the datatypes inferred in the sample are incorrect. The first <code class="docutils literal notranslate"><span class="pre">n</span></code> rows have no value for <code class="docutils literal notranslate"><span class="pre">CRSElapsedTime</span></code> (which pandas infers as a <code class="docutils literal notranslate"><span class="pre">float</span></code>), and later on turn out to be strings (<code class="docutils literal notranslate"><span class="pre">object</span></code> dtype). When this happens you have a few options:</p>
<ul class="simple">
<li><p>Specify dtypes directly using the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> keyword. This is the recommended solution, as it’s the least error prone (better to be explicit than implicit) and also the most performant.</p></li>
<li><p>Increase the size of the <code class="docutils literal notranslate"><span class="pre">sample</span></code> keyword (in bytes)</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">assume_missing</span></code> to make <code class="docutils literal notranslate"><span class="pre">dask</span></code> assume that columns inferred to be <code class="docutils literal notranslate"><span class="pre">int</span></code> (which don’t allow missing values) are actually floats (which do allow missing values). In our particular case this doesn’t apply.</p></li>
</ul>
<p>In our case we’ll use the first option and directly specify the <code class="docutils literal notranslate"><span class="pre">dtypes</span></code> of the offending columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span>
                 <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
                 <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TailNum&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
                        <span class="s1">&#39;CRSElapsedTime&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="s1">&#39;Cancelled&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look at one more example to fix ideas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="why-df-is-ten-times-longer">
<h3>Why df is ten times longer ?<a class="headerlink" href="#why-df-is-ten-times-longer" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Dask investigated the input path and found that there are ten matching files.</p></li>
<li><p>A set of jobs was intelligently created for each chunk - one per original CSV file in this case.</p></li>
<li><p>Each file was loaded into a pandas dataframe, had <code class="docutils literal notranslate"><span class="pre">len()</span></code> applied to it.</p></li>
<li><p>The subtotals were combined to give you the final grant total.</p></li>
</ul>
</section>
</section>
<section id="computations-with-dask-dataframe">
<h2>Computations with <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code><a class="headerlink" href="#computations-with-dask-dataframe" title="Permalink to this headline">#</a></h2>
<p>We compute the maximum of the <code class="docutils literal notranslate"><span class="pre">DepDelay</span></code> column.  With <code class="docutils literal notranslate"><span class="pre">dask.delayed</span></code> we could create this computation as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">maxes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">)(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">maxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    
<span class="n">final_max</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="nb">max</span><span class="p">)(</span><span class="n">maxes</span><span class="p">)</span>
<span class="n">final_max</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we just use the normal Pandas syntax as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> df.DepDelay.max().compute()
</pre></div>
</div>
</div>
</div>
<p>This writes the delayed computation for us and then runs it. Recall that the delayed computation is a dask graph made of up of key-value pairs.</p>
<p>Some things to note:</p>
<ol class="simple">
<li><p>As with <code class="docutils literal notranslate"><span class="pre">dask.delayed</span></code>, we need to call <code class="docutils literal notranslate"><span class="pre">.compute()</span></code> when we’re done.  Up until this point everything is lazy.</p></li>
<li><p>Dask will delete intermediate results (like the full pandas dataframe for each file) as soon as possible.</p>
<ul class="simple">
<li><p>This lets us handle datasets that are larger than memory</p></li>
<li><p>This means that repeated computations will have to load all of the data in each time (run the code above again, is it faster or slower than you would expect?)</p></li>
</ul>
</li>
</ol>
<p>As with <code class="docutils literal notranslate"><span class="pre">Delayed</span></code> objects, you can view the underlying task graph using the <code class="docutils literal notranslate"><span class="pre">.visualize</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If you are already familiar with the Pandas API then know how to use <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code>.  There are a couple of small changes.</p>
<p>As noted above, computations on dask <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects don’t perform work, instead they build up a dask graph.  We can evaluate this dask graph at any time using the <code class="docutils literal notranslate"><span class="pre">.compute()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># create the tasks graph</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> result.compute()           # perform actual computation
</pre></div>
</div>
</div>
</div>
</section>
<section id="store-data-in-apache-parquet-format">
<h2>Store Data in Apache Parquet Format<a class="headerlink" href="#store-data-in-apache-parquet-format" title="Permalink to this headline">#</a></h2>
<p>Dask encourage dataframe users to store and load data using Parquet instead of csv. <a class="reference external" href="http://parquet.apache.org/">Apache Parquet</a> is a columnar binary format that is easy to split into multiple files (easier for parallel loading) and is generally much simpler to deal with than HDF5 (from the Dask library’s perspective). It is also a common format used by other big data systems like <a class="reference external" href="http://spark.apache.org/">Apache Spark</a> and <a class="reference external" href="http://impala.apache.org/">Apache Impala</a> and so is useful to interchange with other systems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;TailNum&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;nycflights/&quot;</span><span class="p">)</span>  <span class="c1"># save csv files using parquet format</span>
</pre></div>
</div>
</div>
</div>
<p>It is possible to specify dtypes and compression when converting. This can definitely help give you significantly greater speedups, but just using the default settings will still be a large improvement.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;nycflights/&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> result.compute()
</pre></div>
</div>
</div>
</div>
<p>The computation is much faster because pulling out the DepDelay column is  easy for Parquet.</p>
<section id="parquet-advantages">
<h3>Parquet advantages:<a class="headerlink" href="#parquet-advantages" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Binary representation of data, allowing for speedy conversion of bytes-on-disk to bytes-in-memory</p></li>
<li><p>Columnar storage, meaning that you can load in as few columns as you need without loading the entire dataset</p></li>
<li><p>Row-chunked storage so that you can pull out data from a particular range without touching the others</p></li>
<li><p>Per-chunk statistics so that you can find subsets quickly</p></li>
<li><p>Compression</p></li>
</ul>
</section>
<section id="exercise-15-1">
<h3>Exercise 15.1<a class="headerlink" href="#exercise-15-1" title="Permalink to this headline">#</a></h3>
<p>If you don’t remember how to use pandas.  Please read <a class="reference external" href="http://pandas.pydata.org/">pandas documentation</a>.</p>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">head()</span></code> method to get the first ten rows</p></li>
<li><p>How many rows are in our dataset?</p></li>
<li><p>Use selections <code class="docutils literal notranslate"><span class="pre">df[...]</span></code> to find how many positive (late) and negative (early) departure times there are</p></li>
<li><p>In total, how many non-cancelled flights were taken? (To invert a boolean pandas Series s, use ~s).</p></li>
</ul>
</section>
</section>
<section id="divisions-and-the-index">
<h2>Divisions and the Index<a class="headerlink" href="#divisions-and-the-index" title="Permalink to this headline">#</a></h2>
<p>The Pandas index associates a value to each record/row of your data.  Operations that align with the index, like <code class="docutils literal notranslate"><span class="pre">loc</span></code> can be a bit faster as a result.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code> this index becomes even more important.  Recall that one dask <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> consists of several Pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s.  These dataframes are separated along the index by value.  For example, when working with time series we may partition our large dataset by month.</p>
<p>Recall that these many partitions of our data may not all live in memory at the same time, instead they might live on disk; we simply have tasks that can materialize these pandas <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> on demand.</p>
<p>Partitioning your data can greatly improve efficiency.  Operations like <code class="docutils literal notranslate"><span class="pre">loc</span></code>, <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, and <code class="docutils literal notranslate"><span class="pre">merge/join</span></code> along the index are <em>much more efficient</em> than operations along other columns.  You can see how your dataset is partitioned with the <code class="docutils literal notranslate"><span class="pre">.divisions</span></code> attribute.  Note that data that comes out of simple data sources like CSV files aren’t intelligently indexed by default.  In these cases the values for <code class="docutils literal notranslate"><span class="pre">.divisions</span></code> will be <code class="docutils literal notranslate"><span class="pre">None.</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span>
                 <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TailNum&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="s1">&#39;CRSElapsedTime&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="s1">&#39;Cancelled&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">})</span>
<span class="n">df</span><span class="o">.</span><span class="n">divisions</span>
</pre></div>
</div>
</div>
</div>
<p>However if we set the index to some new column then dask will divide our data roughly evenly along that column and create new divisions for us.  Warning, <code class="docutils literal notranslate"><span class="pre">set_index</span></code> triggers immediate computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">divisions</span>
</pre></div>
</div>
</div>
</div>
<p>We see here the minimum and maximum values (1990 and 1999) as well as the intermediate values that separate our data well.  This dataset has ten partitions, as the final value is assumed to be the inclusive right-side for the last bin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">npartitions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>One of the benefits of this is that operations like <code class="docutils literal notranslate"><span class="pre">loc</span></code> only need to load the relevant partitions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1991</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1991</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="exercises-15-2">
<h3>Exercises 15.2<a class="headerlink" href="#exercises-15-2" title="Permalink to this headline">#</a></h3>
<p>In this section we do a few <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code> computations. If you are comfortable with Pandas then these should be familiar. You will have to think about when to call <code class="docutils literal notranslate"><span class="pre">compute</span></code>.</p>
<ul class="simple">
<li><p>In total, how many non-cancelled flights were taken from each airport?</p></li>
</ul>
<p><em>Hint</em>: use <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/groupby.html"><code class="docutils literal notranslate"><span class="pre">df.groupby</span></code></a>. <code class="docutils literal notranslate"><span class="pre">df.groupby(df.A).B.func()</span></code>.</p>
<ul class="simple">
<li><p>What was the average departure delay from each airport?</p></li>
</ul>
<p>Note, this is the same computation you did in the previous notebook (is this approach faster or slower?)</p>
<ul class="simple">
<li><p>What day of the week has the worst average departure delay?</p></li>
</ul>
</section>
</section>
<section id="sharing-intermediate-results">
<h2>Sharing Intermediate Results<a class="headerlink" href="#sharing-intermediate-results" title="Permalink to this headline">#</a></h2>
<p>When computing all of the above, we sometimes did the same operation more than once. For most operations, <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code> hashes the arguments, allowing duplicate computations to be shared, and only computed once.</p>
<p>For example, lets compute the mean and standard deviation for departure delay of all non-cancelled flights:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">non_cancelled</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">Cancelled</span><span class="p">]</span>
<span class="n">mean_delay</span> <span class="o">=</span> <span class="n">non_cancelled</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_delay</span> <span class="o">=</span> <span class="n">non_cancelled</span><span class="o">.</span><span class="n">DepDelay</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="using-two-calls-to-compute">
<h3>Using two calls to <code class="docutils literal notranslate"><span class="pre">.compute</span></code>:<a class="headerlink" href="#using-two-calls-to-compute" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mean_delay_res</span> <span class="o">=</span> <span class="n">mean_delay</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">std_delay_res</span> <span class="o">=</span> <span class="n">std_delay</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">mean_delay_res</span><span class="p">,</span> <span class="n">std_delay_res</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="using-one-call-to-dask-compute">
<h3>Using one call to <code class="docutils literal notranslate"><span class="pre">dask.compute</span></code>:<a class="headerlink" href="#using-one-call-to-dask-compute" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">mean_delay_res</span><span class="p">,</span> <span class="n">std_delay_res</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mean_delay</span><span class="p">,</span> <span class="n">std_delay</span><span class="p">)</span>
<span class="n">mean_delay_res</span><span class="p">,</span> <span class="n">std_delay_res</span>
</pre></div>
</div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">dask.compute</span></code> takes roughly 1/2 the time. This is because the task graphs for both results are merged when calling <code class="docutils literal notranslate"><span class="pre">dask.compute</span></code>, allowing shared operations to only be done once instead of twice. In particular, using <code class="docutils literal notranslate"><span class="pre">dask.compute</span></code> only does the following once:</p>
<ul class="simple">
<li><p>the calls to <code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></li>
<li><p>the filter (<code class="docutils literal notranslate"><span class="pre">df[~df.Cancelled]</span></code>)</p></li>
<li><p>some of the necessary reductions (<code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code>)</p></li>
</ul>
<p>To see what the merged task graphs between multiple results look like (and what’s shared), you can use the <code class="docutils literal notranslate"><span class="pre">dask.visualize</span></code> function (we might want to use <code class="docutils literal notranslate"><span class="pre">filename='graph.pdf'</span></code> to zoom in on the graph better):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dask</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">mean_delay</span><span class="p">,</span> <span class="n">std_delay</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "pnavaro/big-data",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "big-data"
        },
        kernelOptions: {
            kernelName: "big-data",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'big-data'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="15-PySpark.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PySpark</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="17-SparkDataFrames.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Spark DataFrames</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Pierre Navaro<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>