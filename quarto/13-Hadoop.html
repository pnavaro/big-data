<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python tools for Big Data - Hadoop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Python tools for Big Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./intro.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pnavaro/big-data" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-GitBasics.html">Notebooks</a></li><li class="breadcrumb-item"><a href="./13-Hadoop.html">Hadoop</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-GitBasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-JupyterQuickStart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-WordCount.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wordcount</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-MapReduce.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Map Reduce</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-ParallelComputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parallel Computation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-AsynchronousProcessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Asynchronous Processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-DaskDelayed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-DaskBag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask bag</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-PandasSeries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PandaDataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas Dataframes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-UnixCommands.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Commands in the Unix Shell</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Hadoop.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Hadoop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-FileFormats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">File Formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-PySpark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PySpark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-DaskDataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask Dataframes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-SparkDataFrames.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark DataFrames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-NYCTaxiCabTripDask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask dataframes on HDFS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-NYCTaxiCabTripSpark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark dataframes on HDFS</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#hdfs" id="toc-hdfs" class="nav-link active" data-scroll-target="#hdfs">HDFS</a></li>
  <li><a href="#accessibility" id="toc-accessibility" class="nav-link" data-scroll-target="#accessibility">Accessibility</a></li>
  <li><a href="#manage-files-and-directories" id="toc-manage-files-and-directories" class="nav-link" data-scroll-target="#manage-files-and-directories">Manage files and directories</a></li>
  <li><a href="#transfer-between-nodes" id="toc-transfer-between-nodes" class="nav-link" data-scroll-target="#transfer-between-nodes">Transfer between nodes</a>
  <ul class="collapse">
  <li><a href="#put" id="toc-put" class="nav-link" data-scroll-target="#put">put</a></li>
  </ul></li>
  <li><a href="#hadoop-cluster" id="toc-hadoop-cluster" class="nav-link" data-scroll-target="#hadoop-cluster">Hadoop cluster</a>
  <ul class="collapse">
  <li><a href="#namenode-web-interface-hdfs-layer" id="toc-namenode-web-interface-hdfs-layer" class="nav-link" data-scroll-target="#namenode-web-interface-hdfs-layer">NameNode Web Interface (HDFS layer)</a></li>
  <li><a href="#secondary-namenode-information." id="toc-secondary-namenode-information." class="nav-link" data-scroll-target="#secondary-namenode-information.">Secondary Namenode Information.</a></li>
  <li><a href="#datanode-information." id="toc-datanode-information." class="nav-link" data-scroll-target="#datanode-information.">Datanode Information.</a></li>
  </ul></li>
  <li><a href="#hands-on-practice" id="toc-hands-on-practice" class="nav-link" data-scroll-target="#hands-on-practice">Hands-on practice:</a></li>
  <li><a href="#yarn" id="toc-yarn" class="nav-link" data-scroll-target="#yarn">YARN</a>
  <ul class="collapse">
  <li><a href="#yarn-web-interface" id="toc-yarn-web-interface" class="nav-link" data-scroll-target="#yarn-web-interface">Yarn Web Interface</a></li>
  </ul></li>
  <li><a href="#wordcount-example" id="toc-wordcount-example" class="nav-link" data-scroll-target="#wordcount-example">WordCount Example</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  </ul></li>
  <li><a href="#deploying-the-mapreduce-python-code-on-hadoop" id="toc-deploying-the-mapreduce-python-code-on-hadoop" class="nav-link" data-scroll-target="#deploying-the-mapreduce-python-code-on-hadoop">Deploying the MapReduce Python code on Hadoop</a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">Map</a></li>
  <li><a href="#reduce" id="toc-reduce" class="nav-link" data-scroll-target="#reduce">Reduce</a></li>
  <li><a href="#execution-on-hadoop-cluster" id="toc-execution-on-hadoop-cluster" class="nav-link" data-scroll-target="#execution-on-hadoop-cluster">Execution on Hadoop cluster</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hadoop</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li>Data sets that are so large or complex that traditional data processing application software is inadequate to deal with them.</li>
<li>Data analysis requires massively parallel software running on several servers.</li>
<li><strong>Volume, Variety, Velocity, Variability and Veracity</strong> describe Big Data properties.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bigdata.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">https://github.com/veekaybee/data-lake-talk/</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hadoop.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Hadoop Logo</figcaption>
</figure>
</div>
<ul>
<li>Framework for running applications on large cluster.</li>
<li>The Hadoop framework transparently provides applications both reliability and data motion.</li>
<li>Hadoop implements the computational paradigm named <strong>Map/Reduce</strong>, where the application is divided into many small fragments of work, each of which may be executed or re-executed on any node in the cluster.</li>
<li>It provides a distributed file system (HDFS) that stores data on the compute nodes, providing very high aggregate bandwidth across the cluster.</li>
<li>Both MapReduce and the <strong>Hadoop Distributed File System</strong> are designed so that node failures are automatically handled by the framework.</li>
</ul>
<section id="hdfs" class="level2">
<h2 class="anchored" data-anchor-id="hdfs">HDFS</h2>
<ul>
<li>It is a distributed file systems.</li>
<li>HDFS is highly fault-tolerant and is designed to be deployed on low-cost hardware.</li>
<li>HDFS is suitable for applications that have large data sets.</li>
<li>HDFS provides interfaces to move applications closer to where the data is located. The computation is much more efficient when the size of the data set is huge.</li>
<li>HDFS consists of a single NameNode with a number of DataNodes which manage storage.</li>
<li>HDFS exposes a file system namespace and allows user data to be stored in files.
<ol type="1">
<li>A file is split by the NameNode into blocks stored in DataNodes.</li>
<li>The <a href="http://svmass2.mass.uhb.fr:50070">NameNode</a> executes operations like opening, closing, and renaming files and directories.</li>
<li>The <a href="http://svmass2.mass.uhb.fr:50090/status.html">Secondary NameNode</a> stores information from <strong>NameNode</strong>.</li>
<li>The <strong>DataNodes</strong> manage perform block creation, deletion, and replication upon instruction from the NameNode.</li>
<li>The placement of replicas is optimized for data reliability, availability, and network bandwidth utilization.</li>
<li>User data never flows through the NameNode.</li>
</ol></li>
<li>Files in HDFS are write-once and have strictly one writer at any time.</li>
<li>The DataNode has no knowledge about HDFS files.</li>
</ul>
</section>
<section id="accessibility" class="level2">
<h2 class="anchored" data-anchor-id="accessibility">Accessibility</h2>
<p>All <a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/FileSystemShell.html">HDFS commands</a> are invoked by the bin/hdfs Java script:</p>
<pre class="shell"><code>hdfs [SHELL_OPTIONS] COMMAND [GENERIC_OPTIONS] [COMMAND_OPTIONS]</code></pre>
</section>
<section id="manage-files-and-directories" class="level2">
<h2 class="anchored" data-anchor-id="manage-files-and-directories">Manage files and directories</h2>
<pre class="shell"><code>hdfs dfs -ls -h -R # Recursively list subdirectories with human-readable file sizes.
hdfs dfs -cp  # Copy files from source to destination
hdfs dfs -mv  # Move files from source to destination
hdfs dfs -mkdir /foodir # Create a directory named /foodir  
hdfs dfs -rmr /foodir   # Remove a directory named /foodir  
hdfs dfs -cat /foodir/myfile.txt #View the contents of a file named /foodir/myfile.txt  </code></pre>
</section>
<section id="transfer-between-nodes" class="level2">
<h2 class="anchored" data-anchor-id="transfer-between-nodes">Transfer between nodes</h2>
<section id="put" class="level3">
<h3 class="anchored" data-anchor-id="put">put</h3>
<pre class="shell"><code>hdfs fs -put [-f] [-p] [-l] [-d] [ - | &lt;localsrc1&gt; .. ]. &lt;dst&gt;</code></pre>
<p>Copy single src, or multiple srcs from local file system to the destination file system.</p>
<p>Options:</p>
<pre><code>-p : Preserves rights and modification times.
-f : Overwrites the destination if it already exists.</code></pre>
<pre class="shell"><code>hdfs fs -put localfile /user/hadoop/hadoopfile
hdfs fs -put -f localfile1 localfile2 /user/hadoop/hadoopdir</code></pre>
<p>Similar to the fs -put command - <code>moveFromLocal</code> : to delete the source localsrc after copy. - <code>copyFromLocal</code> : source is restricted to a local file - <code>copyToLocal</code> : destination is restricted to a local file</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/hdfs-fonctionnement.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">hdfs blocks</figcaption>
</figure>
</div>
<p>The Name Node is not in the data path. The Name Node only provides the map of where data is and where data should go in the cluster (file system metadata).</p>
</section>
</section>
<section id="hadoop-cluster" class="level2">
<h2 class="anchored" data-anchor-id="hadoop-cluster">Hadoop cluster</h2>
<ul>
<li>8 computers: sve1 -&gt; sve9</li>
</ul>
<section id="namenode-web-interface-hdfs-layer" class="level3">
<h3 class="anchored" data-anchor-id="namenode-web-interface-hdfs-layer">NameNode Web Interface (HDFS layer)</h3>
<p>http://svmass2.mass.uhb.fr:50070</p>
<p>The name node web UI shows you a cluster summary including information about total/remaining capacity, live and dead nodes. Additionally, it allows you to browse the HDFS namespace and view the contents of its files in the web browser. It also gives access to the local machine’s Hadoop log files.</p>
</section>
<section id="secondary-namenode-information." class="level3">
<h3 class="anchored" data-anchor-id="secondary-namenode-information.">Secondary Namenode Information.</h3>
<p>http://svmass2.mass.uhb.fr:50090/</p>
</section>
<section id="datanode-information." class="level3">
<h3 class="anchored" data-anchor-id="datanode-information.">Datanode Information.</h3>
<ul>
<li>http://svpe1.mass.uhb.fr:50075/</li>
<li>http://svpe2.mass.uhb.fr:50075/</li>
<li>…</li>
<li>http://svpe8.mass.uhb.fr:50075/</li>
<li>http://svpe9.mass.uhb.fr:50075/</li>
</ul>
<p>To do following hands on you can switch to <a href="https://jupyterlab.readthedocs.io">JupyterLab</a>.</p>
<p>Just go to this following address http://localhost:9000/lab</p>
<ul>
<li>Check that your HDFS home directory required to execute MapReduce jobs exists:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-ls</span> /user/<span class="va">${USER}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Type the following commands:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-ls</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-ls</span> /</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-mkdir</span> test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Create a local file user.txt containing your name and the date:</li>
</ul>
<div class="cell" data-cell_id="00009-f6414ae7-fd9a-47cd-bf43-03c9261c0ae4" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># echo "FirstName LastName" &gt; user.txt</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># echo `date` &gt;&gt; user.txt </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cat user.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Copy it on HDFS :</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-put</span> user.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Check with:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-ls</span> <span class="at">-R</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-cat</span> user.txt </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-tail</span> user.txt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-cell_id="00011-23a1c9fe-3f71-4363-b98e-a806943b5abd" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -put user.txt</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -ls -R /user/navaro_p/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00012-34d0cd52-4319-49ac-89aa-4a113d361762" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -cat user.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove the file:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-rm</span> user.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Put it again on HDFS and move to books directory:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-copyFromLocal</span> user.txt</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-mv</span> user.txt books/user.txt</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-ls</span> <span class="at">-R</span> <span class="at">-h</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Copy user.txt to hello.txt and remove it.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-cp</span> books/user.txt books/hello.txt</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-count</span> <span class="at">-h</span> /user/<span class="va">$USER</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-rm</span> books/user.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="hands-on-practice" class="level2">
<h2 class="anchored" data-anchor-id="hands-on-practice">Hands-on practice:</h2>
<ol type="1">
<li>Create a directory <code>files</code> in HDFS.</li>
<li>List the contents of a directory /.</li>
<li>Upload the file today.txt in HDFS.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span> <span class="op">&gt;</span> today.txt</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">whoami</span> <span class="op">&gt;&gt;</span> today.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Display contents of file <code>today.txt</code></li>
<li>Copy <code>today.txt</code> file from source to <code>files</code> directory.</li>
<li>Copy file <code>jps.txt</code> from/To Local file system to HDFS</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">jps</span> <span class="op">&gt;</span> jps.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="7" type="1">
<li>Move file <code>jps.txt</code> from source to <code>files</code>.</li>
<li>Remove file <code>today.txt</code> from home directory in HDFS.</li>
<li>Display last few lines of <code>jps.txt</code>.</li>
<li>Display the help of <code>du</code> command and show the total amount of space in a human-readable fashion used by your home hdfs directory.</li>
<li>Display the help of <code>df</code> command and show the total amount of space available in the filesystem in a human-readable fashion.</li>
<li>With <code>chmod</code> change the rights of <code>today.txt</code> file. I has to be readable and writeable only by you.</li>
</ol>
</section>
<section id="yarn" class="level2">
<h2 class="anchored" data-anchor-id="yarn">YARN</h2>
<p><em>YARN takes care of resource management and job scheduling/monitoring.</em></p>
<ul>
<li>The <strong>ResourceManager</strong> is the ultimate authority that arbitrates resources among all the applications in the system. It has two components: <strong>Scheduler</strong> and <strong>ApplicationsManager</strong>.</li>
<li>The <strong>NodeManager</strong> is the per-machine framework agent who is responsible for <strong>Containers</strong>, monitoring their resource usage (cpu, memory, disk, network) and reporting the same to the <strong>ResourceManager/Scheduler</strong>.</li>
</ul>
<p>The per-application <strong>ApplicationMaster</strong> negotiates resources from the ResourceManager and working with the NodeManager(s) to execute and monitor the tasks.</p>
<ul>
<li><p>The <strong>Scheduler</strong> is responsible for allocating resources to the applications.</p></li>
<li><p>The <strong>ApplicationsManager</strong> is responsible for accepting job-submissions, tracking their status and monitoring for progress.</p></li>
</ul>
<p><img src="images/yarn_architecture.png" class="img-fluid" alt="Yarn in Hadoop documentation"> Source: http://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif</p>
<section id="yarn-web-interface" class="level3">
<h3 class="anchored" data-anchor-id="yarn-web-interface">Yarn Web Interface</h3>
<p>The JobTracker web UI provides information about general job statistics of the Hadoop cluster, running/completed/failed jobs and a job history log file. It also gives access to the ‘‘local machine’s’’ Hadoop log files (the machine on which the web UI is running on).</p>
<ul>
<li>All Applications http://svmass2.mass.uhb.fr:8088</li>
</ul>
</section>
</section>
<section id="wordcount-example" class="level2">
<h2 class="anchored" data-anchor-id="wordcount-example">WordCount Example</h2>
<p>The <a href="https://wiki.apache.org/hadoop/WordCount">Worcount example</a> is implemented in Java and it is the example of <a href="https://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Hadoop MapReduce Tutorial</a></p>
<p>Let’s create some files with lorem python package</p>
<ul>
<li>Make input directory in your HDFS home directory required to execute MapReduce jobs:</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hdfs</span> dfs <span class="at">-mkdir</span> <span class="at">-p</span> /user/<span class="va">${USER}</span>/input</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>-p</code> flag force the directory creation even if it already exists.</p>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<ul>
<li>Copy all necessary files in HDFS system.</li>
<li>Run the Java example using the command</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hadoop</span> jar /export/hadoop-2.7.6/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.6.jar wordcount /user/you/input /user/you/output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Remove the output directory and try to use yarn</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> jar /export/hadoop-2.7.6/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.6.jar wordcount /user/you/input /user/you/output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Connect to the <a href="http://svmass2.mass.uhb.fr:8088/cluster">Yarn web user interface</a> and read the logs carefully.</li>
</ul>
</section>
</section>
<section id="deploying-the-mapreduce-python-code-on-hadoop" class="level2">
<h2 class="anchored" data-anchor-id="deploying-the-mapreduce-python-code-on-hadoop">Deploying the MapReduce Python code on Hadoop</h2>
<p>This Python must use the <a href="http://hadoop.apache.org/docs/stable/hadoop-streaming/HadoopStreaming.html">Hadoop Streaming API</a> to pass data between our Map and Reduce code via Python’s sys.stdin (standard input) and sys.stdout (standard output).</p>
</section>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">Map</h2>
<p>The following Python code read data from sys.stdin, split it into words and output a list of lines mapping words to their (intermediate) counts to sys.stdout. For every word it outputs <word> 1 tuples immediately.</word></p>
<div class="cell" data-cell_id="00024-6d0edba4-9bc8-496b-9907-14be2f832952" data-deepnote_cell_type="code" data-execution_millis="19" data-execution_start="1604938402949" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-source_hash="a4ea72f2">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span><span class="bu">file</span> mapper.py</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># input comes from standard input</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> sys.stdin:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> line.strip().lower() <span class="co"># remove leading and trailing whitespace</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> line.replace(<span class="st">"."</span>, <span class="st">" "</span>)   <span class="co"># strip punctuation </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> line.split(): <span class="co"># split the line into words</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># write the results to standard output;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># what we output here will be the input for the</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reduce step, i.e. the input for reducer.py</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># tab-delimited; the trivial word count is 1</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span> (<span class="ss">f'</span><span class="sc">{</span>word<span class="sc">}</span><span class="ch">\t</span><span class="ss"> 1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The python script must be executable:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x mapper.py </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Try to run in a terminal with:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> sample01.txt <span class="kw">|</span> <span class="ex">./mapper.py</span> <span class="kw">|</span> <span class="fu">sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./mapper.py</span> <span class="op">&lt;</span> sample01.txt <span class="kw">|</span> <span class="fu">sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-cell_id="00027-65979a33-8c85-4cac-ac6a-438bcfab0068" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># chmod +x mapper.py</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cat sample01.txt | ./mapper.py | sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reduce" class="level2">
<h2 class="anchored" data-anchor-id="reduce">Reduce</h2>
<p>The following code reads the results of mapper.py and sum the occurrences of each word to a final count, and then output its results to sys.stdout. Remember that Hadoop sorts map output so it is easier to count words.</p>
<div class="cell" data-cell_id="00029-88737004-d4de-47a3-a276-3962aa80834a" data-deepnote_cell_type="code" data-execution_millis="30" data-execution_start="1604938524251" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-source_hash="c2ebe356">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span><span class="bu">file</span> reducer.py</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> operator <span class="im">import</span> itemgetter</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>current_word <span class="op">=</span> <span class="va">None</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>current_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>word <span class="op">=</span> <span class="va">None</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> sys.stdin:</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># parse the input we got from mapper.py</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    word, count <span class="op">=</span> line.split(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, <span class="dv">1</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert count (currently a string) to int</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="bu">int</span>(count)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># count was not a number, so silently</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ignore/discard this line</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this IF-switch only works because Hadoop sorts map output</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># by key (here: word) before it is passed to the reducer</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_word <span class="op">==</span> word:</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        current_count <span class="op">+=</span> count</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_word:</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># write result to sys.stdout</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span> (<span class="ss">f'</span><span class="sc">{</span>current_count<span class="sc">}</span><span class="ch">\t</span><span class="sc">{</span>current_word<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        current_count <span class="op">=</span> count</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        current_word <span class="op">=</span> word</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># do not forget to output the last word if needed!</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> current_word <span class="op">==</span> word:</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="ss">f'</span><span class="sc">{</span>current_count<span class="sc">}</span><span class="ch">\t</span><span class="sc">{</span>current_word<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As mapper the python script must be executable:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x reducer.py </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Try to run in a terminal with:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> sample.txt <span class="kw">|</span> <span class="ex">./mapper.py</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="ex">./reducer.py</span> <span class="kw">|</span> <span class="fu">sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./mapper.py</span> <span class="op">&lt;</span> sample01.txt <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="ex">./reducer.py</span> <span class="kw">|</span> <span class="fu">sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-cell_id="00032-22ada548-2ca7-4be1-b1c5-0ac0c3d4aade" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># chmod +x reducer.py </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ./mapper.py &lt; sample01.txt | sort | ./reducer.py | sort</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="execution-on-hadoop-cluster" class="level2">
<h2 class="anchored" data-anchor-id="execution-on-hadoop-cluster">Execution on Hadoop cluster</h2>
<ul>
<li>Copy all files to HDFS cluster</li>
<li>Run the WordCount MapReduce</li>
</ul>
<p>Before to run the following command you need to replace the path to the python executable. To print this path you can use the command</p>
<pre><code>which python</code></pre>
<p>You should get</p>
<pre><code>/opt/tljh/user/bin/python</code></pre>
<p>So replace the line</p>
<pre><code>#!/usr/bin/env python</code></pre>
<p>by</p>
<pre><code>#!/opt/tljh/user/bin/python</code></pre>
<p>in both files mapper.py and reducer.py</p>
<p>Ensure that the output directory does not exist by removing it</p>
<pre><code>hdfs dfs -rm -r output</code></pre>
<p>Use the hadoop streaming library to read files on hdfs and redirect data to standard input, use your python scripts to process the data and write the result on hdfs directory named output :</p>
<pre><code>hadoop jar /export/hadoop-2.7.6/share/hadoop/tools/lib/hadoop-streaming-2.7.6.jar \
-input input/*.txt -output output \
-file ${PWD}/mapper.py -mapper ${PWD}/mapper.py \
-file ${PWD}/reducer.py -reducer ${PWD}/reducer.py</code></pre>
<p>Check the results with</p>
<pre><code>hdfs dfs -cat output/*</code></pre>
<p>You can avoid these long lines commands by editing a Makefile</p>
<div class="cell" data-cell_id="00034-01ed13f1-5e64-4cd1-9c15-e3e122e8f0eb" data-deepnote_cell_type="code" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span><span class="bu">file</span> Makefile</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>HADOOP_VERSION<span class="op">=</span><span class="fl">2.7.6</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>HADOOP_HOME<span class="op">=/</span>export<span class="op">/</span>hadoop<span class="op">-</span>${HADOOP_VERSION}</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>HADOOP_TOOLS<span class="op">=</span>${HADOOP_HOME}<span class="op">/</span>share<span class="op">/</span>hadoop<span class="op">/</span>tools<span class="op">/</span>lib</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>HDFS_DIR<span class="op">=/</span>user<span class="op">/</span>${USER}</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>SAMPLES <span class="op">=</span> sample01.txt sample02.txt sample03.txt sample04.txt</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>copy_to_hdfs: ${SAMPLES}</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    hdfs dfs <span class="op">-</span>mkdir <span class="op">-</span>p ${HDFS_DIR}<span class="op">/</span><span class="bu">input</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    hdfs dfs <span class="op">-</span>put $<span class="op">^</span> ${HDFS_DIR}<span class="op">/</span><span class="bu">input</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>run_with_hadoop: </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    hadoop jar ${HADOOP_TOOLS}<span class="op">/</span>hadoop<span class="op">-</span>streaming<span class="op">-</span>${HADOOP_VERSION}.jar <span class="op">\</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">file</span>  ${PWD}<span class="op">/</span>mapper.py  <span class="op">-</span>mapper  ${PWD}<span class="op">/</span>mapper.py <span class="op">\</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">file</span>  ${PWD}<span class="op">/</span>reducer.py <span class="op">-</span>reducer ${PWD}<span class="op">/</span>reducer.py <span class="op">\</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">input</span> ${HDFS_DIR}<span class="op">/</span><span class="bu">input</span><span class="op">/*</span>.txt <span class="op">-</span>output ${HDFS_DIR}<span class="op">/</span>output<span class="op">-</span>hadoop</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>run_with_yarn: </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    yarn jar ${HADOOP_TOOLS}<span class="op">/</span>hadoop<span class="op">-</span>streaming<span class="op">-</span>${HADOOP_VERSION}.jar <span class="op">\</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">file</span>  ${PWD}<span class="op">/</span>mapper.py  <span class="op">-</span>mapper  ${PWD}<span class="op">/</span>mapper.py <span class="op">\</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">file</span>  ${PWD}<span class="op">/</span>reducer.py <span class="op">-</span>reducer ${PWD}<span class="op">/</span>reducer.py <span class="op">\</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="bu">input</span> ${HDFS_DIR}<span class="op">/</span><span class="bu">input</span><span class="op">/*</span>.txt <span class="op">-</span>output ${HDFS_DIR}<span class="op">/</span>output<span class="op">-</span>yarn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00035-a034949a-6e1f-4716-a304-8039cd216e88" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -rm -r input  # remove input directory</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make copy_to_hdfs # copy sample files to hdfs</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -ls input # list files on hdfs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00036-2dd58a60-b1ac-4360-b0ad-b280b34abbb5" data-deepnote_cell_type="code">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%bash</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -rm -r -f output-hadoop # Remove output directory on hdfs</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make run_with_hadoop  # Run the hadoop streaming map reduce process</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># hdfs dfs -cat output-hadoop/*  # Display results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>