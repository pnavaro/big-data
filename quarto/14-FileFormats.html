<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.504">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python tools for Big Data â€“ fileformats</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Python tools for Big Data</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./intro.html">Home</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Notebooks</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-GitBasics.html" class="sidebar-item-text sidebar-link">Git basics</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Installation.html" class="sidebar-item-text sidebar-link">Installation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-JupyterQuickStart.html" class="sidebar-item-text sidebar-link">Jupyter</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-WordCount.html" class="sidebar-item-text sidebar-link">Wordcount</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-MapReduce.html" class="sidebar-item-text sidebar-link">Map Reduce</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-ParallelComputation.html" class="sidebar-item-text sidebar-link">Parallel Computation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-AsynchronousProcessing.html" class="sidebar-item-text sidebar-link">Asynchronous Processing</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-DaskDelayed.html" class="sidebar-item-text sidebar-link">Dask</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-DaskBag.html" class="sidebar-item-text sidebar-link">Dask bag</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-PandasSeries.html" class="sidebar-item-text sidebar-link">Pandas Series</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PandaDataframes.html" class="sidebar-item-text sidebar-link">Pandas Dataframes</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-UnixCommands.html" class="sidebar-item-text sidebar-link">Basic Commands in the Unix Shell</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Hadoop.html" class="sidebar-item-text sidebar-link">Hadoop</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-FileFormats.html" class="sidebar-item-text sidebar-link active">File Formats</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-PySpark.html" class="sidebar-item-text sidebar-link">PySpark</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-DaskDataframes.html" class="sidebar-item-text sidebar-link">Dask Dataframes</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-SparkDataFrames.html" class="sidebar-item-text sidebar-link">Spark DataFrames</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-NYCTaxiCabTripDask.html" class="sidebar-item-text sidebar-link">Dask dataframes on HDFS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-NYCTaxiCabTripSpark.html" class="sidebar-item-text sidebar-link">Spark dataframes on HDFS</a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#file-formats" id="toc-file-formats" class="nav-link active" data-scroll-target="#file-formats">File Formats</a>
  <ul class="collapse">
  <li><a href="#feather" id="toc-feather" class="nav-link" data-scroll-target="#feather">Feather</a></li>
  <li><a href="#parquet-file-format" id="toc-parquet-file-format" class="nav-link" data-scroll-target="#parquet-file-format">Parquet file format</a></li>
  <li><a href="#hierarchical-data-format" id="toc-hierarchical-data-format" class="nav-link" data-scroll-target="#hierarchical-data-format">Hierarchical Data Format</a></li>
  <li><a href="#feather-or-parquet" id="toc-feather-or-parquet" class="nav-link" data-scroll-target="#feather-or-parquet">Feather or Parquet</a></li>
  <li><a href="#apache-arrow" id="toc-apache-arrow" class="nav-link" data-scroll-target="#apache-arrow">Apache Arrow</a>
  <ul class="collapse">
  <li><a href="#read-csv-from-hdfs" id="toc-read-csv-from-hdfs" class="nav-link" data-scroll-target="#read-csv-from-hdfs">Read CSV from HDFS</a></li>
  <li><a href="#read-parquet-file-from-hdfs-with-pandas" id="toc-read-parquet-file-from-hdfs-with-pandas" class="nav-link" data-scroll-target="#read-parquet-file-from-hdfs-with-pandas">Read Parquet File from HDFS with pandas</a></li>
  <li><a href="#read-parquet-file-with-pyarrow" id="toc-read-parquet-file-with-pyarrow" class="nav-link" data-scroll-target="#read-parquet-file-with-pyarrow">Read Parquet File with pyarrow</a></li>
  <li><a href="#writing-a-parquet-file-from-apache-arrow" id="toc-writing-a-parquet-file-from-apache-arrow" class="nav-link" data-scroll-target="#writing-a-parquet-file-from-apache-arrow">Writing a parquet file from Apache Arrow</a></li>
  <li><a href="#check-metadata" id="toc-check-metadata" class="nav-link" data-scroll-target="#check-metadata">Check metadata</a></li>
  <li><a href="#see-schema" id="toc-see-schema" class="nav-link" data-scroll-target="#see-schema">See schema</a></li>
  <li><a href="#connect-to-the-hadoop-file-system" id="toc-connect-to-the-hadoop-file-system" class="nav-link" data-scroll-target="#connect-to-the-hadoop-file-system">Connect to the Hadoop file system</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="file-formats" class="level1">
<h1>File Formats</h1>
<p>I present three data formats, feather, parquet and hdf but it exists several more like <a href="http://avro.apache.org/docs/current/">Apache Avro</a> or <a href="https://orc.apache.org">Apache ORC</a>.</p>
<p>These data formats may be more appropriate in certain situations. However, the software needed to handle them is either more difficult to install, incomplete, or more difficult to use because less documentation is provided. For ORC and AVRO the python libraries offered are less well maintained than the formats we will see. You can find many on the web but it is hard to know which one is the most stable. - <a href="https://github.com/noirello/pyorc">pyorc</a> - <a href="https://avro.apache.org/docs/1.10.0/gettingstartedpython.html">avro</a> and <a href="https://github.com/fastavro/fastavro">fastavro</a> The following formats are supported by pandas and apache arrow. These softwares are supported by very strong communities.</p>
<section id="feather" class="level2">
<h2 class="anchored" data-anchor-id="feather">Feather</h2>
<p>For light data, it is recommanded to use <a href="https://github.com/wesm/feather">Feather</a>. It is a fast, interoperable data frame storage that comes with bindings for python and R.</p>
<p>Feather uses also the Apache Arrow columnar memory specification to represent binary data on disk. This makes read and write operations very fast.</p>
</section>
<section id="parquet-file-format" class="level2">
<h2 class="anchored" data-anchor-id="parquet-file-format">Parquet file format</h2>
<p><a href="https://github.com/apache/parquet-format">Parquet format</a> is a common binary data store, used particularly in the Hadoop/big-data sphere. It provides several advantages relevant to big-data processing:</p>
<p>The Apache Parquet project provides a standardized open-source columnar storage format for use in data analysis systems. It was created originally for use in Apache Hadoop with systems like Apache Drill, Apache Hive, Apache Impala, and Apache Spark adopting it as a shared standard for high performance data IO.</p>
</section>
<section id="hierarchical-data-format" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-data-format">Hierarchical Data Format</h2>
<p><a href="https://en.wikipedia.org/wiki/Hierarchical_Data_Format">HDF</a> is a self-describing data format allowing an application to interpret the structure and contents of a file with no outside information. One HDF file can hold a mix of related objects which can be accessed as a group or as individual objects.</p>
<p>Letâ€™s create some big dataframe with consitent data (Floats) and 10% of missing values:</p>
<div class="cell" data-cell_id="00002-86f06cb5-60f9-4b76-8b28-d8be6216d31c" data-deepnote_cell_type="code" data-execution_millis="365" data-execution_start="1605607212760" data-source_hash="2148f3e9" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> feather</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.random.randn(<span class="dv">500000</span>) <span class="co"># 10% nulls</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>arr[::<span class="dv">10</span>] <span class="op">=</span> np.nan</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'column_</span><span class="sc">{0}</span><span class="st">'</span>.<span class="bu">format</span>(i): arr <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00003-6c3102ae-966b-4c76-863d-02e663356c24" data-deepnote_cell_type="code" data-execution_millis="9969" data-execution_start="1605607226298" data-source_hash="601b1750" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_csv(<span class="st">'test.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7.25 s, sys: 467 ms, total: 7.72 s
Wall time: 7.75 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00007-eebd2468-f5fd-4c69-83c1-1c7680da818a" data-deepnote_cell_type="code" data-execution_millis="904" data-execution_start="1605607570330" data-source_hash="648965ca" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>rm test.h5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rm: test.h5: No such file or directory</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00003-3efe272e-e2c6-4f92-a559-d1a7e7cc422e" data-deepnote_cell_type="code" data-execution_millis="3074" data-execution_start="1605607572677" data-source_hash="9511287b" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_hdf(<span class="st">"test.h5"</span>, key<span class="op">=</span><span class="st">"test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 66.6 ms, sys: 70.2 ms, total: 137 ms
Wall time: 1.83 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00003-e32d9d18-f251-4149-a739-083b7e98905c" data-deepnote_cell_type="code" data-execution_millis="1258" data-execution_start="1605607364857" data-source_hash="3658418d" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_parquet(<span class="st">'test.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 260 ms, sys: 42.7 ms, total: 303 ms
Wall time: 1.14 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00003-3d58cd78-c520-45a8-aee0-c9786b4ee486" data-deepnote_cell_type="code" data-execution_millis="524" data-execution_start="1605607390362" data-source_hash="8a260d4f" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_feather(<span class="st">'test.feather'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 158 ms, sys: 28 ms, total: 186 ms
Wall time: 111 ms</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00011-ea9189a2-035b-4a8e-84cc-1c71a317ef88" data-deepnote_cell_type="code" data-execution_millis="51" data-execution_start="1605607453945" data-source_hash="48eefa13" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>bash</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>du <span class="op">-</span>sh test.<span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 97M    test.csv
 36M    test.feather
 42M    test.h5
 37M    test.parquet</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00008-48514262-1c39-4f50-8244-d1e3f75760d8" data-deepnote_cell_type="code" data-execution_millis="2122" data-execution_start="1605607494359" data-source_hash="5e7e15ac" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"test.csv"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 749 ms, sys: 98.7 ms, total: 848 ms
Wall time: 850 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>500000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00009-fb4d1486-9047-47fd-804b-d8498e9234ce" data-deepnote_cell_type="code" data-execution_millis="1400" data-execution_start="1605607580459" data-source_hash="71468c8a" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_hdf(<span class="st">"test.h5"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 51 ms, sys: 52.5 ms, total: 103 ms
Wall time: 104 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>500000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00010-34278fa4-4bee-4496-a023-b02519d5e310" data-deepnote_cell_type="code" data-execution_millis="871" data-execution_start="1605607590036" data-source_hash="afb15a98" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(<span class="st">"test.parquet"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 82.2 ms, sys: 76.4 ms, total: 159 ms
Wall time: 623 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>500000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00003-304f31cd-09e7-4629-8bcd-29d0d3de97a8" data-deepnote_cell_type="code" data-execution_millis="504" data-execution_start="1605607599396" data-source_hash="5110928f" data-execution_count="11">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_feather(<span class="st">"test.feather"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 31.8 ms, sys: 34.4 ms, total: 66.3 ms
Wall time: 30.8 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>500000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00012-200d2d6f-7b4f-4739-87e5-ee1d535d3eea" data-deepnote_cell_type="code" data-execution_start="1605607647672" data-source_hash="83688577" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we create a new big dataframe with a column of strings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00004-9d559345-404e-4d73-bbe0-ab773d5e751b" data-deepnote_cell_type="code" data-execution_millis="29715" data-execution_start="1605607754053" data-source_hash="11d4259f" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lorem <span class="im">import</span> sentence</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> np.array(sentence().strip().lower().replace(<span class="st">"."</span>, <span class="st">" "</span>).split())</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the seed so that the numbers can be reproduced.</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)  </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">1000000</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(np.c_[np.random.randn(n, <span class="dv">5</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                  np.random.randint(<span class="dv">0</span>,<span class="dv">10</span>,(n, <span class="dv">2</span>)),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                  np.random.randint(<span class="dv">0</span>,<span class="dv">1</span>,(n, <span class="dv">2</span>)),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>np.array([np.random.choice(words) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)])] , </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>columns<span class="op">=</span><span class="bu">list</span>(<span class="st">'ABCDEFGHIJ'</span>))</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"A"</span>][::<span class="dv">10</span>] <span class="op">=</span> np.nan</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00006-dbb81bcb-1dae-4e78-b88f-7261409341b8" data-deepnote_cell_type="code" data-execution_millis="6742" data-execution_start="1605607804335" data-source_hash="86969307" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'test.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 4.66 s, sys: 207 ms, total: 4.87 s
Wall time: 4.93 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00015-4af8fb60-2e45-41a8-8173-c03959c65112" data-deepnote_cell_type="code" data-execution_millis="10808" data-execution_start="1605607849621" data-source_hash="60cee7f2" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df.to_hdf(<span class="st">'test.h5'</span>, key<span class="op">=</span><span class="st">"test"</span>, mode<span class="op">=</span><span class="st">"w"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;timed eval&gt;:1: PerformanceWarning: 
your performance may suffer as PyTables will pickle object types that it cannot
map directly to c-types [inferred_type-&gt;mixed,key-&gt;block0_values] [items-&gt;Index(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'], dtype='object')]
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.71 s, sys: 539 ms, total: 3.25 s
Wall time: 3.49 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00007-169983f0-f35d-4d2d-a62d-dac421509f03" data-deepnote_cell_type="code" data-execution_millis="2654" data-execution_start="1605607878875" data-source_hash="a5d7fbf1" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df.to_feather(<span class="st">'test.feather'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 768 ms, sys: 136 ms, total: 904 ms
Wall time: 836 ms</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00017-a8112e1b-2c08-47ac-b740-059f6cb840b2" data-deepnote_cell_type="code" data-execution_millis="2305" data-execution_start="1605607913541" data-source_hash="ad143313" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df.to_parquet(<span class="st">'test.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.07 s, sys: 68.6 ms, total: 1.14 s
Wall time: 1.19 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00018-2b95458f-c287-4419-86e5-c617a63ef1ef" data-deepnote_cell_type="code" data-execution_millis="8728" data-execution_start="1605607923868" data-source_hash="bdf7d1af" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"test.csv"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.17 s, sys: 216 ms, total: 1.38 s
Wall time: 1.38 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00019-ee4b525b-cc49-49a1-85c0-c79bbb36d662" data-deepnote_cell_type="code" data-execution_millis="13601" data-execution_start="1605607936800" data-source_hash="771dceb3" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_hdf(<span class="st">"test.h5"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.12 s, sys: 420 ms, total: 1.54 s
Wall time: 1.54 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00020-7e533430-03e7-4486-9512-4a5e3fdc7fca" data-deepnote_cell_type="code" data-execution_millis="9103" data-execution_start="1605607954950" data-source_hash="a1e5a992" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_feather(<span class="st">'test.feather'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.62 s, sys: 440 ms, total: 2.06 s
Wall time: 1.98 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00005-c284124d-89af-4ee1-9c47-60d6d5a0241c" data-deepnote_cell_type="code" data-execution_millis="10083" data-execution_start="1605607999155" data-source_hash="f37bbfe5" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(<span class="st">'test.parquet'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.79 s, sys: 447 ms, total: 2.24 s
Wall time: 1.8 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00027-c22ed092-a58d-4375-affd-da5887c25b6d" data-deepnote_cell_type="code" data-execution_millis="5" data-execution_start="1605608063341" data-source_hash="f30f989a" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>F</th>
      <th>G</th>
      <th>H</th>
      <th>I</th>
      <th>J</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>0.4001572083672233</td>
      <td>0.9787379841057392</td>
      <td>2.240893199201458</td>
      <td>1.8675579901499675</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>dolorem</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.977277879876411</td>
      <td>0.9500884175255894</td>
      <td>-0.1513572082976979</td>
      <td>-0.10321885179355784</td>
      <td>0.41059850193837233</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>dolorem</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.144043571160878</td>
      <td>1.454273506962975</td>
      <td>0.7610377251469934</td>
      <td>0.12167501649282841</td>
      <td>0.44386323274542566</td>
      <td>6</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>eius</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.33367432737426683</td>
      <td>1.4940790731576061</td>
      <td>-0.20515826376580087</td>
      <td>0.31306770165090136</td>
      <td>-0.8540957393017248</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>numquam</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-2.5529898158340787</td>
      <td>0.6536185954403606</td>
      <td>0.8644361988595057</td>
      <td>-0.7421650204064419</td>
      <td>2.2697546239876076</td>
      <td>6</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>sed</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.4543656745987648</td>
      <td>0.04575851730144607</td>
      <td>-0.1871838500258336</td>
      <td>1.5327792143584575</td>
      <td>1.469358769900285</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>labore</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.1549474256969163</td>
      <td>0.37816251960217356</td>
      <td>-0.8877857476301128</td>
      <td>-1.980796468223927</td>
      <td>-0.3479121493261526</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>voluptatem</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.15634896910398005</td>
      <td>1.2302906807277207</td>
      <td>1.2023798487844113</td>
      <td>-0.3873268174079523</td>
      <td>-0.30230275057533557</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>sed</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.0485529650670926</td>
      <td>-1.4200179371789752</td>
      <td>-1.7062701906250126</td>
      <td>1.9507753952317897</td>
      <td>-0.5096521817516535</td>
      <td>7</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>eius</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.4380743016111864</td>
      <td>-1.2527953600499262</td>
      <td>0.7774903558319101</td>
      <td>-1.6138978475579515</td>
      <td>-0.2127402802139687</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>voluptatem</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-cell_id="00011-8618020c-4639-4a88-b9f2-0e1212e9c7cf" data-deepnote_cell_type="code" data-execution_millis="470" data-execution_start="1605608091018" data-source_hash="d56ddf52" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'J'</span>] <span class="op">=</span> pd.Categorical(df.J)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-cell_id="00023-cf2defbc-03c8-4b43-becd-82bc3e39cdee" data-deepnote_cell_type="code" data-execution_millis="1959" data-execution_start="1605608105636" data-source_hash="1ddaec9a" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_feather(<span class="st">'test.feather'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 557 ms, sys: 85.9 ms, total: 643 ms
Wall time: 597 ms</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00024-8c3f3bc6-d8b5-4915-a22e-89d77df8f8a3" data-deepnote_cell_type="code" data-execution_millis="2699" data-execution_start="1605608134600" data-source_hash="3658418d" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time df.to_parquet(<span class="st">'test.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 935 ms, sys: 66.1 ms, total: 1 s
Wall time: 1.06 s</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00012-7c986385-4bc6-4c82-8079-36a53df467ef" data-deepnote_cell_type="code" data-execution_millis="6995" data-execution_start="1605608145002" data-source_hash="a1e5a992" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_feather(<span class="st">'test.feather'</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.29 s, sys: 322 ms, total: 1.61 s
Wall time: 1.55 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>1000000</code></pre>
</div>
</div>
<div class="cell" data-cell_id="00024-245a1c05-2399-4d6c-95f0-195be6f23e3e" data-deepnote_cell_type="code" data-execution_millis="10342" data-execution_start="1605608190354" data-source_hash="f37bbfe5" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(<span class="st">'test.parquet'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.59 s, sys: 357 ms, total: 1.94 s
Wall time: 1.67 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>1000000</code></pre>
</div>
</div>
</section>
<section id="feather-or-parquet" class="level2">
<h2 class="anchored" data-anchor-id="feather-or-parquet">Feather or Parquet</h2>
<ul>
<li>Parquet format is designed for long-term storage, where Arrow is more intended for short term or ephemeral storage because files volume are larger.</li>
<li>Parquet is usually more expensive to write than Feather as it features more layers of encoding and compression.</li>
<li>Feather is unmodified raw columnar Arrow memory. We will probably add simple compression to Feather in the future.</li>
<li>Due to dictionary encoding, RLE encoding, and data page compression, Parquet files will often be much smaller than Feather files</li>
<li>Parquet is a standard storage format for analytics thatâ€™s supported by Spark. So if you are doing analytics, Parquet is a good option as a reference storage format for query by multiple systems</li>
</ul>
<p><a href="https://stackoverflow.com/questions/48083405/what-are-the-differences-between-feather-and-parquet">source stackoverflow</a></p>
</section>
<section id="apache-arrow" class="level2">
<h2 class="anchored" data-anchor-id="apache-arrow">Apache Arrow</h2>
<p><a href="https://arrow.apache.org/docs/python/">Arrow</a> is a columnar in-memory analytics layer designed to accelerate big data. It houses a set of canonical in-memory representations of hierarchical data along with multiple language-bindings for structure manipulation. Arrow offers an unified way to be able to share the same data representation among languages and it will certainly be the next standard to store dataframes in all languages.</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/arrow/index.html">R package</a></li>
<li><a href="https://github.com/JuliaData/Arrow.jl">Julia package</a></li>
<li><a href="https://github.com/apache/arrow">GitHub project</a></li>
</ul>
<p><img src="images/arrow_ecosystem.png" class="img-fluid"></p>
<p>Apache Arrow is an ideal in-memory transport layer for data that is being read or written with Parquet files. <a href="https://arrow.apache.org/docs/python/">PyArrow</a> includes Python bindings to read and write Parquet files with pandas.</p>
<ul>
<li>columnar storage, only read the data of interest</li>
<li>efficient binary packing</li>
<li>choice of compression algorithms and encoding</li>
<li>split data into files, allowing for parallel processing</li>
<li>range of logical types</li>
<li>statistics stored in metadata allow for skipping unneeded chunks</li>
<li>data partitioning using the directory structure</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/arrow.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">arrow</figcaption><p></p>
</figure>
</div>
<ul>
<li>https://arrow.apache.org/docs/python/csv.html</li>
<li>https://arrow.apache.org/docs/python/feather.html</li>
<li>https://arrow.apache.org/docs/python/parquet.html</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> np.random.randn(<span class="dv">500000</span>) <span class="co"># 10% nulls</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>arr[::<span class="dv">10</span>] <span class="op">=</span> np.nan</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'column_</span><span class="sc">{0}</span><span class="st">'</span>.<span class="bu">format</span>(i): arr <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)})</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>hdfs <span class="op">=</span> pa.hdfs.<span class="ex">connect</span>()</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pa.Table.from_pandas(df)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>pq.write_to_dataset(table, root_path<span class="op">=</span><span class="st">"test"</span>, filesystem<span class="op">=</span>hdfs)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>hdfs.ls(<span class="st">"test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="read-csv-from-hdfs" class="level3">
<h3 class="anchored" data-anchor-id="read-csv-from-hdfs">Read CSV from HDFS</h3>
<p>Put the file test.csv on hdfs system</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> csv</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> hdfs.<span class="bu">open</span>(<span class="st">"/data/nycflights/1999.csv"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a> df <span class="op">=</span> pd.read_csv(f, nrows <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="read-parquet-file-from-hdfs-with-pandas" class="level3">
<h3 class="anchored" data-anchor-id="read-parquet-file-from-hdfs-with-pandas">Read Parquet File from HDFS with pandas</h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>wikipedia <span class="op">=</span> pd.read_parquet(<span class="st">"hdfs://svmass2.mass.uhb.fr:54310/data/pagecounts-parquet/part-00007-8575060f-6b57-45ea-bf1d-cd77b6141f70.snappy.parquet"</span>, engine<span class="op">=</span>â€™pyarrowâ€™)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wikipedia.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="read-parquet-file-with-pyarrow" class="level3">
<h3 class="anchored" data-anchor-id="read-parquet-file-with-pyarrow">Read Parquet File with pyarrow</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pq.read_table(<span class="st">"example.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="writing-a-parquet-file-from-apache-arrow" class="level3">
<h3 class="anchored" data-anchor-id="writing-a-parquet-file-from-apache-arrow">Writing a parquet file from Apache Arrow</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>pq.write_table(table, <span class="st">"example.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="check-metadata" class="level3">
<h3 class="anchored" data-anchor-id="check-metadata">Check metadata</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>parquet_file <span class="op">=</span> pq.ParquetFile(<span class="st">"example.parquet"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(parquet_file.metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="see-schema" class="level3">
<h3 class="anchored" data-anchor-id="see-schema">See schema</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(parquet_file.schema)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="connect-to-the-hadoop-file-system" class="level3">
<h3 class="anchored" data-anchor-id="connect-to-the-hadoop-file-system">Connect to the Hadoop file system</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>hdfs <span class="op">=</span> pa.hdfs.<span class="ex">connect</span>()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># copy to local</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> hdfs.<span class="bu">open</span>(<span class="st">"user.txt"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    f.download(<span class="st">"user.text"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># write parquet file on hdfs</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"example.parquet"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    pa.HadoopFileSystem.upload(hdfs, <span class="st">"example.parquet"</span>, f)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="co"># List files</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> hdfs.ls(<span class="st">"/user/navaro_p"</span>):</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(f)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create a small dataframe and write it to hadoop file system</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>small_df <span class="op">=</span> pd.DataFrame(np.array([[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]]), columns<span class="op">=</span>[<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>])</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pa.Table.from_pandas(small_df)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>pq.write_table(table, <span class="st">"small_df.parquet"</span>, filesystem<span class="op">=</span>hdfs)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Read files from Hadoop with pandas</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> hdfs.<span class="bu">open</span>(<span class="st">"/data/irmar.csv"</span>) <span class="im">as</span> f:</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Read parquet file from Hadoop with pandas</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>server <span class="op">=</span> <span class="st">"hdfs://svmass2.mass.uhb.fr:54310"</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">"data/pagecounts-parquet/part-00007-8575060f-6b57-45ea-bf1d-cd77b6141f70.snappy.parquet"</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>pagecount <span class="op">=</span> pd.read_parquet(os.path.join(server, path), engine<span class="op">=</span><span class="st">"pyarrow"</span>)</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pagecount.head())</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Read parquet file from Hadoop with pyarrow</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pq.read_table(os.path.join(server,path))</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(table.schema)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> table.to_pandas()</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<ul>
<li>Take the second dataframe with string as last column</li>
<li>Create an arrow table from pandas dataframe</li>
<li>Write the file test.parquet from arrow table</li>
<li>Print metadata from this parquet file</li>
<li>Print schema</li>
<li>Upload the file to hadoop file system</li>
<li>Read this file from hadoop file system and print dataframe head</li>
</ul>
<p>Hint: check the doc https://arrow.apache.org/docs/python/parquet.html</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>