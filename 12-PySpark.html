

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PySpark &#8212; Python tools for Big data</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://pnavaro.github.io/big-data/12-PySpark.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic Commands in the Unix Shell" href="13-UnixCommands.html" />
    <link rel="prev" title="Pandas Dataframes" href="11-PandaDataframes.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://pnavaro.github.io/big-data/12-PySpark.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="PySpark" />
<meta property="og:description" content="PySpark  Logo  Apache Spark was first released in 2014.  It was originally developed by Matei Zaharia as a class project, and later a PhD dissertation, at Unive" />
<meta property="og:image"       content="https://pnavaro.github.io/big-data/_static/logoR2-Noir.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logoR2-Noir.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Python tools for Big data</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01-GitBasics.html">
   Git basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01-GitBasics.html#enable-github-pages">
   Enable GitHub pages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-Installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-JupyterQuickStart.html">
   Jupyter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-WordCount.html">
   Wordcount
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-MapReduce.html">
   Map Reduce
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-ParallelComputation.html">
   Parallel Computation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-AsynchronousProcessing.html">
   Asynchronous Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-DaskDelayed.html">
   Dask
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09-DaskBag.html">
   Dask bag
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10-PandasSeries.html">
   Pandas Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-PandaDataframes.html">
   Pandas Dataframes
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   PySpark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-UnixCommands.html">
   Basic Commands in the Unix Shell
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14-Hadoop.html">
   Hadoop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15-HadoopFileFormats.html">
   Hadoop File Formats
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16-DaskDataframes.html">
   Dask Dataframes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17-SparkDataFrames.html">
   Spark DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18-NYCTaxiCabTripDask.html">
   Dask dataframes on HDFS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19-NYCTaxiCabTripSpark.html">
   Spark dataframes on HDFS
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/12-PySpark.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/pnavaro/big-data"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/pnavaro/big-data/issues/new?title=Issue%20on%20page%20%2F12-PySpark.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/pnavaro/big-data/edit/master/notebooks/12-PySpark.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/pnavaro/big-data/master?urlpath=tree/notebooks/12-PySpark.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/pnavaro/big-data/blob/master/notebooks/12-PySpark.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resilient-distributed-datasets">
   Resilient distributed datasets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lifecycle-of-a-spark-program">
   Lifecycle of a Spark Program
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operations-on-distributed-data">
   Operations on Distributed Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transformations-lazy">
   Transformations (lazy)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#actions">
   Actions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-api">
   Python API
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-sparkcontext-class">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     SparkContext
    </span>
   </code>
   class
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-example">
   First example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-your-first-rdd">
   Create your first RDD
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collect">
     Collect
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map">
     Map
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter">
     Filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flatmap">
     FlatMap
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Exercise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groupby">
     GroupBy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#groupbykey">
     GroupByKey
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#join">
     Join
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distinct">
     Distinct
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#keyby">
     KeyBy
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   Actions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map-reduce-operation">
     Map-Reduce operation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-min-sum-mean-variance-stdev">
     Max, Min, Sum, Mean, Variance, Stdev
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#countbykey">
     CountByKey
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-10-1-word-count-in-apache-spark">
     Exercise 10.1 Word-count in Apache Spark
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sparksession">
   SparkSession
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pi-computation-example">
     <span class="math notranslate nohighlight">
      \(\pi\)
     </span>
     computation example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-9-2">
     Exercise 9.2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation-between-daily-stock">
     Correlation between daily stock
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequential-code">
     Sequential code
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-9-3">
     Exercise 9.3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-9-4-fasta-file-example">
     Exercise 9.4 Fasta file example
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#another-example">
     Another example
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="pyspark">
<h1>PySpark<a class="headerlink" href="#pyspark" title="Permalink to this headline">¶</a></h1>
<p><img alt="Logo" src="_images/apache_spark_logo.png" /></p>
<ul class="simple">
<li><p><a class="reference external" href="https://spark.apache.org">Apache Spark</a> was first released in 2014.</p></li>
<li><p>It was originally developed by <a class="reference external" href="http://people.csail.mit.edu/matei">Matei Zaharia</a> as a class project, and later a PhD dissertation, at University of California, Berkeley.</p></li>
<li><p>Spark is written in <a class="reference external" href="https://www.scala-lang.org">Scala</a>.</p></li>
<li><p>All images come from <a class="reference external" href="https://databricks.com/product/getting-started-guide">Databricks</a>.</p></li>
</ul>
<ul class="simple">
<li><p>Apache Spark is a fast and general-purpose cluster computing system.</p></li>
<li><p>It provides high-level APIs in Java, Scala, Python and R, and an optimized engine that supports general execution graphs.</p></li>
<li><p>Spark can manage “big data” collections with a small set of high-level primitives like <code class="docutils literal notranslate"><span class="pre">map</span></code>, <code class="docutils literal notranslate"><span class="pre">filter</span></code>, <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, and <code class="docutils literal notranslate"><span class="pre">join</span></code>.  With these common patterns we can often handle computations that are more complex than map, but are still structured.</p></li>
<li><p>It also supports a rich set of higher-level tools including <a class="reference external" href="https://spark.apache.org/docs/latest/sql-programming-guide.html">Spark SQL</a> for SQL and structured data processing, <a class="reference external" href="https://spark.apache.org/docs/latest/ml-guide.html">MLlib</a> for machine learning, <a class="reference external" href="https://spark.apache.org/docs/latest/graphx-programming-guide.html">GraphX</a> for graph processing, and Spark Streaming.</p></li>
</ul>
<div class="section" id="resilient-distributed-datasets">
<h2>Resilient distributed datasets<a class="headerlink" href="#resilient-distributed-datasets" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The fundamental abstraction of Apache Spark is a read-only, parallel, distributed, fault-tolerent collection called a resilient distributed datasets (RDD).</p></li>
<li><p>RDDs behave a bit like Python collections (e.g. lists).</p></li>
<li><p>When working with Apache Spark we iteratively apply functions to every item of these collections in parallel to produce <em>new</em> RDDs.</p></li>
<li><p>The data is distributed across nodes in a cluster of computers.</p></li>
<li><p>Functions implemented in Spark can work in parallel across elements of the collection.</p></li>
<li><p>The  Spark framework allocates data and processing to different nodes, without any intervention from the programmer.</p></li>
<li><p>RDDs automatically rebuilt on machine failure.</p></li>
</ul>
</div>
<div class="section" id="lifecycle-of-a-spark-program">
<h2>Lifecycle of a Spark Program<a class="headerlink" href="#lifecycle-of-a-spark-program" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Create some input RDDs from external data or parallelize a collection in your driver program.</p></li>
<li><p>Lazily transform them to define new RDDs using transformations like <code class="docutils literal notranslate"><span class="pre">filter()</span></code> or <code class="docutils literal notranslate"><span class="pre">map()</span></code></p></li>
<li><p>Ask Spark to cache() any intermediate RDDs that will need to be reused.</p></li>
<li><p>Launch actions such as count() and collect() to kick off a parallel computation, which is then optimized and executed by Spark.</p></li>
</ol>
</div>
<div class="section" id="operations-on-distributed-data">
<h2>Operations on Distributed Data<a class="headerlink" href="#operations-on-distributed-data" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Two types of operations: <strong>transformations</strong> and <strong>actions</strong></p></li>
<li><p>Transformations are <em>lazy</em> (not computed immediately)</p></li>
<li><p>Transformations are executed when an action is run</p></li>
</ul>
</div>
<div class="section" id="transformations-lazy">
<h2><a class="reference external" href="https://spark.apache.org/docs/latest/rdd-programming-guide.html#transformations">Transformations</a> (lazy)<a class="headerlink" href="#transformations-lazy" title="Permalink to this headline">¶</a></h2>
<div class="highlight-spark notranslate"><div class="highlight"><pre><span></span>map() flatMap()
filter() 
mapPartitions() mapPartitionsWithIndex() 
sample()
union() intersection() distinct()
groupBy() groupByKey()
reduceBy() reduceByKey()
sortBy() sortByKey()
join()
cogroup()
cartesian()
pipe()
coalesce()
repartition()
partitionBy()
...
</pre></div>
</div>
</div>
<div class="section" id="actions">
<h2><a class="reference external" href="https://spark.apache.org/docs/latest/rdd-programming-guide.html#actions">Actions</a><a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reduce</span><span class="p">()</span>
<span class="n">collect</span><span class="p">()</span>
<span class="n">count</span><span class="p">()</span>
<span class="n">first</span><span class="p">()</span>
<span class="n">take</span><span class="p">()</span>
<span class="n">takeSample</span><span class="p">()</span>
<span class="n">saveToCassandra</span><span class="p">()</span>
<span class="n">takeOrdered</span><span class="p">()</span>
<span class="n">saveAsTextFile</span><span class="p">()</span>
<span class="n">saveAsSequenceFile</span><span class="p">()</span>
<span class="n">saveAsObjectFile</span><span class="p">()</span>
<span class="n">countByKey</span><span class="p">()</span>
<span class="n">foreach</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="python-api">
<h2>Python API<a class="headerlink" href="#python-api" title="Permalink to this headline">¶</a></h2>
<p>PySpark uses Py4J that enables Python programs to dynamically access Java objects.</p>
<p><img alt="PySpark Internals" src="_images/YlI8AqEl.png" /></p>
</div>
<div class="section" id="the-sparkcontext-class">
<h2>The <code class="docutils literal notranslate"><span class="pre">SparkContext</span></code> class<a class="headerlink" href="#the-sparkcontext-class" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>When working with Apache Spark we invoke methods on an object which is an instance of the <code class="docutils literal notranslate"><span class="pre">pyspark.SparkContext</span></code> context.</p></li>
<li><p>Typically, an instance of this object will be created automatically for you and assigned to the variable <code class="docutils literal notranslate"><span class="pre">sc</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">parallelize</span></code> method in <code class="docutils literal notranslate"><span class="pre">SparkContext</span></code> can be used to turn any ordinary Python collection into an RDD;</p>
<ul>
<li><p>normally we would create an RDD from a large file or an HBase table.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="first-example">
<h2>First example<a class="headerlink" href="#first-example" title="Permalink to this headline">¶</a></h2>
<p>PySpark isn’t on sys.path by default, but that doesn’t mean it can’t be used as a regular library. You can address this by either symlinking pyspark into your site-packages, or adding pyspark to sys.path at runtime. <a class="reference external" href="https://github.com/minrk/findspark">findspark</a> does the latter.</p>
<p>We have a spark context sc to use with a tiny local spark cluster with 4 nodes (will work just fine on a multicore machine).</p>
<p>If you use the workstation in room A111 run the code below before:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">findspark</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span><span class="p">,</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/export/spark-2.3.1-bin-hadoop2.7&quot;</span>

<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/usr/share/miniconda3/envs/big-data/bin/python&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYSPARK_PYTHON&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">49</span><span class="n">d7c4e178f8</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pyspark</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pyspark&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s2">&quot;local[*]&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="o">=</span><span class="s2">&quot;FirstExample&quot;</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="c1"># it is like a Pool Processor executor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SparkContext master=local[*] appName=FirstExample&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-your-first-rdd">
<h2>Create your first RDD<a class="headerlink" href="#create-your-first-rdd" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span> <span class="c1"># create collection</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParallelCollectionRDD[0] at readRDDFromFile at PythonRDD.scala:262
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h3>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">sample.txt</span></code>with lorem package. Read and load it into a RDD with the <code class="docutils literal notranslate"><span class="pre">textFile</span></code> spark function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lorem</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;sample.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lorem</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
    
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;sample.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="collect">
<h3>Collect<a class="headerlink" href="#collect" title="Permalink to this headline">¶</a></h3>
<p>Action / To Driver: Return all items in the RDD to the driver in a single list</p>
<p><img alt="" src="_images/DUO6ygB.png" /></p>
<p>Source: https://i.imgur.com/DUO6ygB.png</p>
</div>
<div class="section" id="id1">
<h3>Exercise<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Collect the text you read before from the <code class="docutils literal notranslate"><span class="pre">sample.txt</span></code>file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Numquam dolore quisquam tempora dolore modi. Dolorem adipisci modi ipsum porro modi sit adipisci. Ipsum quaerat labore aliquam sit eius dolorem dolorem. Porro tempora labore non numquam etincidunt. Aliquam velit quaerat eius consectetur.&#39;,
 &#39;&#39;,
 &#39;Dolor consectetur voluptatem voluptatem est numquam adipisci. Numquam magnam labore eius ut. Velit labore sed ipsum consectetur non non voluptatem. Non modi numquam quiquia neque modi. Dolor etincidunt quisquam porro amet numquam neque porro. Modi voluptatem modi est.&#39;,
 &#39;&#39;,
 &#39;Quiquia dolor velit neque sit ut. Neque voluptatem dolorem aliquam. Etincidunt sed sit magnam. Quaerat ipsum voluptatem sit velit dolorem dolore dolor. Ut numquam labore velit ipsum modi adipisci numquam.&#39;,
 &#39;&#39;,
 &#39;Velit consectetur consectetur dolore neque adipisci porro. Dolorem adipisci non adipisci. Voluptatem sed neque consectetur sed. Magnam dolore sit est quaerat. Tempora etincidunt amet non modi labore ut aliquam.&#39;,
 &#39;&#39;,
 &#39;Sit sed eius magnam. Est sit sit magnam non consectetur sit dolore. Non ipsum consectetur aliquam etincidunt voluptatem. Amet dolore sed eius. Tempora tempora velit quaerat quisquam est quisquam. Sed velit modi eius. Ut tempora numquam magnam voluptatem labore.&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="map">
<h3>Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Narrow: Return a new RDD by applying a function to each element of this RDD</p>
<p><img alt="" src="_images/PxNJf0U.png" /></p>
<p>Source: http://i.imgur.com/PxNJf0U.png</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="c1"># Square each element</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 4, 9, 16, 25, 36, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Exercise<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Replace the lambda function by a function that contains a pause (sleep(1)) and check if the <code class="docutils literal notranslate"><span class="pre">map</span></code> operation is parallelized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="o">%</span><span class="k">time</span> rdd.map(square).collect()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 5.88 ms, sys: 3.81 ms, total: 9.69 ms
Wall time: 1.07 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 4, 9, 16, 25, 36, 49]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Narrow: Return a new RDD containing only the elements that satisfy a predicate</p>
<p><img alt="" src="_images/GFyji4U.png" />
Source: http://i.imgur.com/GFyji4U.png</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select only the even elements</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 2, 4, 6]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="flatmap">
<h3>FlatMap<a class="headerlink" href="#flatmap" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Narrow: Return a new RDD by first applying a function to all elements of this RDD, and then flattening the results</p>
<p><img alt="" src="_images/TsSUex8.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 100, 42, 2, 200, 42, 3, 300, 42]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Exercise<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Use FlatMap to clean the text from <code class="docutils literal notranslate"><span class="pre">sample.txt</span></code>file. Lower, remove dots and split into words.</p>
</div>
<div class="section" id="groupby">
<h3>GroupBy<a class="headerlink" href="#groupby" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Wide: Group the data in the original RDD. Create pairs where the key is the output of a user function, and the value is all items for which the function yields this key.</p>
<p><img alt="" src="_images/gdj0Ey8.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Fred&#39;</span><span class="p">,</span> <span class="s1">&#39;Anna&#39;</span><span class="p">,</span> <span class="s1">&#39;James&#39;</span><span class="p">])</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rdd</span><span class="o">.</span><span class="n">collect</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;J&#39;, [&#39;John&#39;, &#39;James&#39;]), (&#39;F&#39;, [&#39;Fred&#39;]), (&#39;A&#39;, [&#39;Anna&#39;])]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="groupbykey">
<h3>GroupByKey<a class="headerlink" href="#groupbykey" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Wide: Group the values for each key in the original RDD. Create a new pair where the original key corresponds to this collected group of values.</p>
<p><img alt="" src="_images/TlWRGr2.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span>
<span class="p">[(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">rdd</span><span class="o">.</span><span class="n">collect</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;B&#39;, [5, 4]), (&#39;A&#39;, [3, 2, 1])]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="join">
<h3>Join<a class="headerlink" href="#join" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Wide: Return a new RDD containing all pairs of elements having the same key in the original RDDs</p>
<p><img alt="" src="_images/YXL42Nl.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>
<span class="n">x</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;b&#39;, (2, 5)), (&#39;a&#39;, (1, 3)), (&#39;a&#39;, (1, 4))]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="distinct">
<h3>Distinct<a class="headerlink" href="#distinct" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Wide: Return a new RDD containing distinct items from the original RDD (omitting all duplicates)</p>
<p><img alt="" src="_images/Vqgy2a4.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 4]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="keyby">
<h3>KeyBy<a class="headerlink" href="#keyby" title="Permalink to this headline">¶</a></h3>
<p>Transformation / Narrow: Create a Pair RDD, forming one pair for each item in the original RDD. The pair’s key is calculated from the value via a user-supplied function.</p>
<p><img alt="" src="_images/nqYhDW5.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Fred&#39;</span><span class="p">,</span> <span class="s1">&#39;Anna&#39;</span><span class="p">,</span> <span class="s1">&#39;James&#39;</span><span class="p">])</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">keyBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;J&#39;, &#39;John&#39;), (&#39;F&#39;, &#39;Fred&#39;), (&#39;A&#39;, &#39;Anna&#39;), (&#39;J&#39;, &#39;James&#39;)]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>Actions<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="map-reduce-operation">
<h3>Map-Reduce operation<a class="headerlink" href="#map-reduce-operation" title="Permalink to this headline">¶</a></h3>
<p>Action / To Driver: Aggregate all the elements of the RDD by applying a user function pairwise to elements and partial results, and return a result to the driver</p>
<p><img alt="" src="_images/R72uzwX.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">)</span> <span class="c1"># reduce is an action!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>140
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="max-min-sum-mean-variance-stdev">
<h3>Max, Min, Sum, Mean, Variance, Stdev<a class="headerlink" href="#max-min-sum-mean-variance-stdev" title="Permalink to this headline">¶</a></h3>
<p>Action / To Driver: Compute the respective function (maximum value, minimum value, sum, mean, variance, or standard deviation) from a numeric RDD</p>
<p><img alt="" src="_images/HUCtib1.png" /></p>
</div>
<div class="section" id="countbykey">
<h3>CountByKey<a class="headerlink" href="#countbykey" title="Permalink to this headline">¶</a></h3>
<p>Action / To Driver: Return a map of keys and counts of their occurrences in the RDD</p>
<p><img alt="" src="_images/jvQTGv6.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;James&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;Fred&#39;</span><span class="p">),</span> 
                    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;Anna&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="s1">&#39;John&#39;</span><span class="p">)])</span>

<span class="n">rdd</span><span class="o">.</span><span class="n">countByKey</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>defaultdict(int, {&#39;J&#39;: 2, &#39;F&#39;: 1, &#39;A&#39;: 1})
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stop the local spark cluster</span>
<span class="n">sc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise-10-1-word-count-in-apache-spark">
<h3>Exercise 10.1 Word-count in Apache Spark<a class="headerlink" href="#exercise-10-1-word-count-in-apache-spark" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Write the sample text file</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lorem</span> <span class="kn">import</span> <span class="n">text</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sample.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Create the rdd with <code class="docutils literal notranslate"><span class="pre">SparkContext.textFile</span> <span class="pre">method</span></code></p></li>
<li><p>lower, remove dots and split using <code class="docutils literal notranslate"><span class="pre">rdd.flatMap</span></code></p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">rdd.map</span></code> to create the list of key/value pair (word, 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rdd.reduceByKey</span></code> to get all occurences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rdd.takeOrdered</span></code>to get sorted frequencies of words</p></li>
</ul>
<p>All documentation is available <a class="reference external" href="https://spark.apache.org/docs/2.1.0/api/python/pyspark.html?highlight=textfile#pyspark.SparkContext">here</a> for textFile and <a class="reference external" href="https://spark.apache.org/docs/2.1.0/api/python/pyspark.html?highlight=textfile#pyspark.RDD">here</a> for RDD.</p>
<p>For a global overview see the Transformations section of the <a class="reference external" href="https://spark.apache.org/docs/latest/rdd-programming-guide.html">programming guide</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s2">&quot;local[*]&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="o">=</span><span class="s2">&quot;wordcount&quot;</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;sample.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">rdd</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
   <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span> <span class="p">:</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
   <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">w</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
   <span class="o">.</span><span class="n">sortBy</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">w</span> <span class="p">:</span> <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;non&#39;, 8),
 (&#39;ipsum&#39;, 6),
 (&#39;quiquia&#39;, 6),
 (&#39;labore&#39;, 6),
 (&#39;modi&#39;, 6),
 (&#39;voluptatem&#39;, 6),
 (&#39;dolorem&#39;, 6),
 (&#39;numquam&#39;, 5),
 (&#39;dolor&#39;, 5),
 (&#39;velit&#39;, 5),
 (&#39;est&#39;, 4),
 (&#39;tempora&#39;, 4),
 (&#39;quaerat&#39;, 4),
 (&#39;magnam&#39;, 4),
 (&#39;sit&#39;, 4),
 (&#39;etincidunt&#39;, 4),
 (&#39;aliquam&#39;, 4),
 (&#39;quisquam&#39;, 4),
 (&#39;porro&#39;, 3),
 (&#39;eius&#39;, 3),
 (&#39;sed&#39;, 3),
 (&#39;consectetur&#39;, 3),
 (&#39;adipisci&#39;, 3),
 (&#39;ut&#39;, 3),
 (&#39;dolore&#39;, 3),
 (&#39;neque&#39;, 3),
 (&#39;amet&#39;, 2)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="sparksession">
<h2>SparkSession<a class="headerlink" href="#sparksession" title="Permalink to this headline">¶</a></h2>
<p>Since SPARK 2.0.0,  SparkSession provides a single point
of entry to interact with Spark functionality and
allows programming Spark with DataFrame and Dataset APIs.</p>
<div class="section" id="pi-computation-example">
<h3><span class="math notranslate nohighlight">\(\pi\)</span> computation example<a class="headerlink" href="#pi-computation-example" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We can estimate an approximate value for <span class="math notranslate nohighlight">\(\pi\)</span> using the following Monte-Carlo method:</p></li>
</ul>
<ol class="simple">
<li><p>Inscribe a circle in a square</p></li>
<li><p>Randomly generate points in the square</p></li>
<li><p>Determine the number of points in the square that are also in the circle</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(r\)</span> be the number of points in the circle divided by the number of points in the square, then <span class="math notranslate nohighlight">\(\pi \approx 4 r\)</span>.</p></li>
</ol>
<ul class="simple">
<li><p>Note that the more points generated, the better the approximation</p></li>
</ul>
<p>See <a class="reference external" href="https://computing.llnl.gov/tutorials/parallel_comp/#ExamplesPI">this tutorial</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>

<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="p">(</span><span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span>
         <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;PythonPi&quot;</span><span class="p">)</span>
         <span class="o">.</span><span class="n">getOrCreate</span><span class="p">())</span>

<span class="n">partitions</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span> <span class="o">*</span> <span class="n">partitions</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">partitions</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pi is roughly </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">count</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>

<span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pi is roughly 3.142200
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise-9-2">
<h3>Exercise 9.2<a class="headerlink" href="#exercise-9-2" title="Permalink to this headline">¶</a></h3>
<p>Using the same method than the PI computation example, compute the integral
$<span class="math notranslate nohighlight">\(
I = \int_0^1 \exp(-x^2) dx
\)</span>$
You can check your result with numpy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># numpy evaluates solution using numeric computation. </span>
<span class="c1"># It uses discrete values of the function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7468240713763741
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># numpy and scipy evaluates solution using numeric computation. It uses discrete values</span>
<span class="c1"># of the function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>
<span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># note: the solution returned is complex </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.7468241328124271, 8.291413475940725e-15)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="correlation-between-daily-stock">
<h3>Correlation between daily stock<a class="headerlink" href="#correlation-between-daily-stock" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Data preparation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>  <span class="c1"># library to get directory and file paths</span>
<span class="kn">import</span> <span class="nn">tarfile</span> <span class="c1"># this module makes possible to read and write tar archives</span>

<span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">where</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">datadir</span><span class="p">):</span>
       <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting data...&quot;</span><span class="p">)</span>
       <span class="n">tar_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.tgz&#39;</span><span class="p">)</span>
       <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
          <span class="n">data</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>
            
<span class="n">extract_data</span><span class="p">(</span><span class="s1">&#39;daily-stock&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="c1"># this function call will extract json files</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;daily-stock&#39;</span><span class="p">)</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datadir</span><span class="p">,</span> <span class="s1">&#39;*.json&#39;</span><span class="p">)))</span>
<span class="n">filenames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/aet.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/afl.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/aig.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/al.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/amgn.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/avy.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/b.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/bwa.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/ge.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hal.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hp.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hpq.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/ibm.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/jbl.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/jpm.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/luv.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/met.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/pcg.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/tgt.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/usb.json&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/xom.json&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">rm</span> data/daily-stock/*.h5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="n">out_filename</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="s1">&#39;/data&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">out_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;daily-stock&#39;</span><span class="p">,</span> <span class="s1">&#39;*.h5&#39;</span><span class="p">)))</span>  <span class="c1"># data/json/*.json</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished : aet.h5
Finished : afl.h5
Finished : aig.h5
Finished : al.h5
Finished : amgn.h5
Finished : avy.h5
Finished : b.h5
Finished : bwa.h5
Finished : ge.h5
Finished : hal.h5
Finished : hp.h5
Finished : hpq.h5
Finished : ibm.h5
Finished : jbl.h5
Finished : jpm.h5
Finished : luv.h5
Finished : met.h5
Finished : pcg.h5
Finished : tgt.h5
Finished : usb.h5
Finished : xom.h5
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="sequential-code">
<h3>Sequential code<a class="headerlink" href="#sequential-code" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filenames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;data/daily-stock/aet.h5&#39;,
 &#39;data/daily-stock/afl.h5&#39;,
 &#39;data/daily-stock/aig.h5&#39;,
 &#39;data/daily-stock/al.h5&#39;,
 &#39;data/daily-stock/amgn.h5&#39;,
 &#39;data/daily-stock/avy.h5&#39;,
 &#39;data/daily-stock/b.h5&#39;,
 &#39;data/daily-stock/bwa.h5&#39;,
 &#39;data/daily-stock/ge.h5&#39;,
 &#39;data/daily-stock/hal.h5&#39;,
 &#39;data/daily-stock/hp.h5&#39;,
 &#39;data/daily-stock/hpq.h5&#39;,
 &#39;data/daily-stock/ibm.h5&#39;,
 &#39;data/daily-stock/jbl.h5&#39;,
 &#39;data/daily-stock/jpm.h5&#39;,
 &#39;data/daily-stock/luv.h5&#39;,
 &#39;data/daily-stock/met.h5&#39;,
 &#39;data/daily-stock/pcg.h5&#39;,
 &#39;data/daily-stock/tgt.h5&#39;,
 &#39;data/daily-stock/usb.h5&#39;,
 &#39;data/daily-stock/xom.h5&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s1">&#39;data/daily-stock/aet.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf</span><span class="p">:</span>
    <span class="c1"># This prints a list of all group names:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hdf</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/data&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;data/daily-stock/aet.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">series</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>   <span class="c1"># Simple map over filenames</span>
    <span class="n">series</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="s2">&quot;close&quot;</span><span class="p">])</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">series</span><span class="p">:</span>    <span class="c1"># Doubly nested loop over the same collection</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">series</span><span class="p">:</span>  
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>     <span class="c1"># Filter out comparisons of the same series </span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>  <span class="c1"># Apply function</span>

<span class="n">result</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.18 s, sys: 207 ms, total: 1.39 s
Wall time: 1.31 s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9413176064560878
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercise-9-3">
<h3>Exercise 9.3<a class="headerlink" href="#exercise-9-3" title="Permalink to this headline">¶</a></h3>
<p>Parallelize the code above with Apache Spark.</p>
<ul class="simple">
<li><p>Change the filenames because of the Hadoop environment.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span>

<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;daily-stock&#39;</span><span class="p">,</span> <span class="s1">&#39;*.h5&#39;</span><span class="p">)))</span>
<span class="n">filenames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/aet.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/afl.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/aig.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/al.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/amgn.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/avy.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/b.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/bwa.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/ge.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hal.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hp.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/hpq.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/ibm.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/jbl.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/jpm.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/luv.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/met.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/pcg.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/tgt.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/usb.h5&#39;,
 &#39;/Users/navaro/PycharmProjects/big-data/notebooks/data/daily-stock/xom.h5&#39;]
</pre></div>
</div>
</div>
</div>
<p>If it is not started don’t forget the PySpark context</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Parallel code</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s2">&quot;local[*]&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="o">=</span><span class="s2">&quot;series&quot;</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>

<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fn</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="s1">&#39;close&#39;</span><span class="p">])</span>

<span class="n">corr</span> <span class="o">=</span> <span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
              <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ab</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
              <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ab</span><span class="p">:</span> <span class="n">ab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
              <span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9413176064560878
</pre></div>
</div>
</div>
</div>
<p>Computation time is slower because there is a lot of setup, workers creation, there is a lot of communications the correlation function is too small</p>
</div>
<div class="section" id="exercise-9-4-fasta-file-example">
<h3>Exercise 9.4 Fasta file example<a class="headerlink" href="#exercise-9-4-fasta-file-example" title="Permalink to this headline">¶</a></h3>
<p>Use a RDD to calculate the GC content of fasta file nucleotide-sample.txt:</p>
<div class="math notranslate nohighlight">
\[\cfrac{G+C}{A+T+G+C}\times100 \% \]</div>
<p>Create a rdd from fasta file genome.txt in data directory and count ‘G’ and ‘C’ then divide by the total number of bases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s2">&quot;local[*]&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="o">=</span><span class="s2">&quot;series&quot;</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>

<span class="n">genome</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s1">&#39;data/genome.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="n">genome</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">lines</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5048333333333334
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="another-example">
<h3>Another example<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h3>
<p>Compute the most frequent sequence with 5 bases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">group_characters</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">ch</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">result</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">group_and_split</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">sequence</span> <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">group_characters</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>

<span class="n">sequences</span> <span class="o">=</span> <span class="n">genome</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">group_and_split</span><span class="p">)</span>
<span class="n">sequences</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;GATCA&#39;, &#39;ATGAG&#39;, &#39;GTGGA&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">counts</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;CTGTG&#39;, 59),
 (&#39;CCCAG&#39;, 55),
 (&#39;CCTGG&#39;, 52),
 (&#39;AAAAA&#39;, 49),
 (&#39;TGCTG&#39;, 42),
 (&#39;TGTGT&#39;, 41),
 (&#39;CCACC&#39;, 39),
 (&#39;GGCTG&#39;, 38),
 (&#39;CACCA&#39;, 37),
 (&#39;GTGGG&#39;, 37)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "pnavaro/big-data",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "big-data"
        },
        kernelOptions: {
            kernelName: "big-data",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'big-data'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="11-PandaDataframes.html" title="previous page">Pandas Dataframes</a>
    <a class='right-next' id="next-link" href="13-UnixCommands.html" title="next page">Basic Commands in the Unix Shell</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Pierre Navaro<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>